<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>The Only AngularJS Modal Service You'll Ever Need &#183; Dave Kerr</title><meta name=description content="If you need modals in an AngularJS application, look no further. I'll show you how to use the Angular Modal Service to add Bootstrap Modals or your own custom modals to your application.
See it in a fiddle or check out a full set of samples online.
Contents  [Using the Angular Modal Service](#UsingTheAngular ModalService) A Quick Example Design Goals How It Works Wrapping Up  Using the Angular Modal Service Here's how you can use the Angular Modal Service to add a bootstrap modal to your application."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.61.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="The Only AngularJS Modal Service You'll Ever Need"><meta property="og:description" content="If you need modals in an AngularJS application, look no further. I'll show you how to use the Angular Modal Service to add Bootstrap Modals or your own custom modals to your application.
See it in a fiddle or check out a full set of samples online.
Contents  [Using the Angular Modal Service](#UsingTheAngular ModalService) A Quick Example Design Goals How It Works Wrapping Up  Using the Angular Modal Service Here's how you can use the Angular Modal Service to add a bootstrap modal to your application."><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/the-only-angularjs-modal-service-youll-ever-need/"><link rel=stylesheet href=http://example.org/dist/styles.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-41728580-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=dwmkerr.com href=http://example.org/>dwmkerr.com</a></h1><a class=button-square href=http://example.org/index.xml><i class="fa fa-rss"></i></a><a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/dwmkerr rel=me><i class="fa fa-twitter"></i></a><a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/dwmkerr rel=me><i class="fa fa-github-alt"></i></a><a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href=https://stackoverflow.com/users/1189164/dave-kerr rel=me><i class="fa fa-stack-overflow"></i></a><a class="button-square button-social hint--top" data-hint=LinkedIn title=LinkedIn href=https://www.linkedin.com/in/dwmkerr/ rel=me><i class="fa fa-linkedin"></i></a></div><ul class=site-nav><li class=site-nav-item><a title=Blog href=/>Blog</a></li><li class=site-nav-item><a title=Speaking href=/page/speaking/>Speaking</a></li><li class=site-nav-item><a title=About href=/page/about/>About</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">The Only AngularJS Modal Service You'll Ever Need</h1><p class="post-date post-line"><span>Published <time datetime=2014-06-16 itemprop=datePublished>Mon, Jun 16, 2014</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/dwmkerr itemprop=url rel=author>Dave Kerr</a></span></span></p></header><div class="post-content clearfix" itemprop=articleBody><p>If you need modals in an AngularJS application, look no further. I'll show you how to use the <a href=https://github.com/dwmkerr/angular-modal-service>Angular Modal Service</a> to add Bootstrap Modals or your own custom modals to your application.</p><p><a href=http://jsfiddle.net/dwmkerr/8MVLJ/>See it in a fiddle</a> or check out <a href=http://dwmkerr.github.io/angular-modal-service>a full set of samples online</a>.</p><h4 id=contents>Contents</h4><ol><li>[Using the Angular Modal Service](#UsingTheAngular ModalService)</li><li><a href=#AQuickExample>A Quick Example</a></li><li><a href=#DesignGoals>Design Goals</a></li><li><a href=#HowItWorks>How It Works</a></li><li><a href=#WrappingUp>Wrapping Up</a></li></ol><h2 id=using-the-angular-modal-service>Using the Angular Modal Service</h2><p>Here's how you can use the Angular Modal Service to add a bootstrap modal to your application.</p><h4 id=step-1-install-with-bower>Step 1: Install with Bower</h4><p>Install the service with bower:</p><pre><code>bower install angular-modal-service --save
</code></pre><p>If you don't use bower, just get the source directly from the <a href=https://github.com/dwmkerr/angular-modal-service/tree/master/dst><code>dst</code></a> folder of the repo.</p><h4 id=step-2-include-the-javascript>Step 2: Include the JavaScript</h4><p>Include the JavaScript from the <code>dst</code> folder or require it with require.js:</p><pre><code class=language-language-html data-lang=language-html>&lt;script src=&quot;bower_components\angular-modal-service\dst\angular-modal-service.min.js&quot;&gt;&lt;/script&gt;
</code></pre><h4 id=step-3-add-it-as-a-dependency>Step 3: Add it as a dependency</h4><p>Make sure the <code>angularModalService</code> module is listed as a required module for your application:</p><pre><code class=language-language-javascript data-lang=language-javascript>var app = angular.module('myApp', ['angularModalService']);
</code></pre><h4 id=step-4-show-the-modal>Step 4: Show the Modal</h4><p>Inject <code>ModalService</code> into any controller, directive or service and call the <code>showModal</code> function to show a modal:</p><pre><code class=language-language data-lang=language>app.controller('SampleController', function($scope, ModalService) {

  ModalService.showModal({
    templateUrl: &quot;template.html&quot;,
    controller: &quot;ModalController&quot;
  }).then(function(modal) {
    
    //it's a bootstrap element, use 'modal' to show it
    modal.element.modal();
    modal.close.then(function(result) {
      console.log(result);
    });
  });

);
</code></pre><p>This code loads the HTML from <code>template.html</code>, adds it to the DOM, creates a scope for it and creates an instance of a <code>ModalController</code>.</p><p>When this is done, the promise returned by the <code>showModal</code> function resolves and you get a <code>modal</code> object. This object contains the element created. If it's a Bootstrap modal just call <code>modal</code> to show it, if it's a custom one you can show it by changing its CSS styles or using whatever APIs are provided. There's an example ofa custom modal in <a href=http://dwmkerr.github.io/angular-modal-service/>the samples</a>.</p><h4 id=step-5-close-the-modal>Step 5: Close the Modal</h4><p>The controller that is created always has one extra parameter injected into it - a function called <code>close</code>. Call this function to close the modal, anything you pass to it is passed to the caller as the <code>result</code> object.</p><pre><code class=language-language data-lang=language>app.controller('ModalController', function($scope, close) {
  
  // when you need to close the modal, call close
  close(&quot;Success!&quot;);
});
</code></pre><p>You can pass a number of milliseconds to wait before destroying the DOM element as an optional second parameter to <code>close</code> - this is useful if the closing of the modal is animated and you don't want it to disappear before the animation completes.</p><h2 id=a-quick-example>A Quick Example</h2><p>Here's a fiddle of the modal service in action:</p><iframe width=100% height=300 src=http://jsfiddle.net/dwmkerr/8MVLJ/embedded/result,js,html allowfullscreen frameborder=0></iframe><p>One thing to note in this examples is that the template is just declared in the DOM - this works fine because the service always checks the template cache before attempting to load it from the server.</p><p>There are more examples at <a href=http://dwmkerr.github.io/angular-modal-service/>dwmkerr.github.io/angular-modal-service</a>.</p><h2 id=design-goals>Design Goals</h2><p>There are some other services for handling modals out there, notably <a href=https://github.com/Fundoo-Solutions/angularjs-modal-service>Fundoo's Modal Service</a> and a few others. However, the design goals for my service were slightly different:</p><ol><li><strong>No link to bootstrap</strong>. Bootstrap modals are complex with lots of options - if you want to use them then that's great, the service should work with them, but the complexity of the options for Bootstrap Modals should not increase the complexity of the service.</li><li><strong>Extremely simple code</strong>. It's rare you'll write something that it will suit everyone's need. Rather than trying to please everyone, I want a service that is simple enough to understand so that it can be easily adapted by others.</li></ol><p>So the core goal here is simplicity - if others can understand the code, then they can more effectively decide whether it's what they need, or build upon it.</p><p>With these design goals in mind I built the angular modal service.</p><h2 id=how-it-works>How It Works</h2><p>I'm going to walk through a slightly simplified version of the code because it actually illustrates quite a few important concepts when working with AngularJS.</p><p>One of the things that's useful to know is that this service creates a DOM element, builds a scope for it and instantiates a controller for it - what we're doing is <em>very</em> similar to what AngularJS does behind the scenes when a directive is created.</p><p>So let's dive in. We're going to define a service, so we need a module.</p><pre><code class=language-language-javascript data-lang=language-javascript>var module = angular.module('angularModalService', []);
</code></pre><p>Now we have our module, we can define our service. I tend to write services in the form of classes, but this is a personal choice - it's just as valid to return a javascript object that contains functions and data.</p><pre><code class=language-language-javascript data-lang=language-javascript>module.factory('ModalService', ['$document', '$compile', '$controller', '$http', '$rootScope', '$q', '$timeout',
    function($document, $compile, $controller, $http, $rootScope, $q, $timeout) {
</code></pre><p>I need a lot of injected components, we'll see why as we continue. I also use the explicit form of the function which takes the parameters as strings - this is the only safe way to write an injected function if you are minifying code.</p><pre><code class=language-language-javascript data-lang=language-javascript>    var body = $document.find('body');    
    function ModalService() {
      var self = this;
</code></pre><p>I use the <code>$document</code> object to get the body element, which the modal will be appended to. I then create a class function and record <code>this</code> as self, so that I can refer to the class instance in callbacks and so on.</p><p>The next part of the code creates a function that will return the template, given either a raw template string or a template url. The reason we wrap this function like this is that the operation will either be synchronous or asynchronous, and I don't want the caller to care. So we use promises to wrap the logic.</p><pre><code class=language-language-javascript data-lang=language-javascript>var getTemplate = function(template, templateUrl) {
  var deferred = $q.defer();
  if(template) {
    deferred.resolve(template);
  } else if(templateUrl) {
    $http({method: 'GET', url: templateUrl, cache: true})
    .then(function(result) {
      deferred.resolve(result.data);
    })
    .catch(function(error) {
      deferred.reject(error);
    });
  } else {
    deferred.reject(&quot;No template or templateUrl has been specified.&quot;);
  }
  return deferred.promise;
};
</code></pre><p>If any of this seems confusing, check out my article <a href=http://www.dwmkerr.com/promises-in-angularjs-the-definitive-guide/>AngularJS Promises - The Definitive Guide</a>.</p><p>Now to the main function.</p><pre><code class=language-language-javascript data-lang=language-javascript>self.showModal = function(options) {        
  var deferred = $q.defer();
</code></pre><p>The <code>showModal</code> function is going to have to do all sorts of async work - loading the template from the server and so on. So we are going to create a <code>deferred</code> object and build a promise to return to the caller.</p><pre><code class=language-language-javascript data-lang=language-javascript>var controller = options.controller;
if(!controller) {
  deferred.reject(&quot;No controller has been specified.&quot;);
  return deferred.promise;
}
</code></pre><p>Now we validate that a controller has been passed in as part of the options. Notice how just like in <code>getTemplate</code> we use the <code>reject</code> function to deal with error cases. Again, if error handling with promises seems unfamiliar, check out <a href=http://www.dwmkerr.com/promises-in-angularjs-the-definitive-guide/>AngularJS Promises - The Definitive Guide</a>.</p><p>Next we deal with the template.</p><pre><code class=language-language-javascript data-lang=language-javascript>getTemplate(options.template, options.templateUrl)
  .then(function(template) {
</code></pre><p>We've used the <code>getTemplate</code> function to get the template, sync or async it doesn't matter, our logic is the same.</p><p>Now we can build a new scope for our modal.</p><pre><code class=language-language-javascript data-lang=language-javascript>var modalScope = $rootScope.$new();
</code></pre><p>We'll refer to this a lot later on. Now for some cleverness.</p><pre><code class=language-language-javascript data-lang=language-javascript>var closeDeferred = $q.defer();
var inputs = {
  $scope: modalScope,
  close: function(result, delay) {
    if(delay === undefined || delay === null) delay = 0;
    $timeout(function () {
      closeDeferred.resolve(result);
    }, delay);
  }
};
</code></pre><p>This requires some explanation. First, we create a new <code>deferred</code> object. This is going to be used to build a promise that is resolved when the modal closes.</p><p>Now we build an <code>input</code> object. This contains parameters we want to inject to the controller we're going to create. Any parameters the controller needs, such as <code>$element</code>, <code>$timeout</code> or whatever will be injected by angular. We're just going to make sure that the <code>$scope</code> that is injected is the one we've just created, and that we also inject a function called &lsquo;close&rsquo;. This function simply resolves the promise we've created after a specified timeout.</p><p>This means that any controller for a modal can take <code>close</code> as a parameter, and we'll inject the function that resolves the promise. This promise is returned to the consumer so that they can take action when the modal closes. We also allow the controller to pass a variable to <code>close</code> which is passed to the <code>resolve</code> function as well.</p><pre><code class=language-language-javascript data-lang=language-javascript>if(options.inputs) {
  for(var inputName in options.inputs) {
    inputs[inputName] = options.inputs[inputName];
  }
}
</code></pre><p>Without the this code, the service is close to useless. What we do here is allow the caller to provide extra inputs to the controller. Imagine we have a list of items, maybe books for a library program, and when the use clicks on one we want to show a modal. The code that shows the modal needs to pass the selected book to the modal controller - by adding it to the <code>inputs</code> object, the book can be injected into the controller. This allows to client to pass data <strong>to</strong> the controller, with the parameter of the <code>close</code> function used to return data <strong>from</strong> the controller.</p><p>Ready for some lower level Angular?</p><pre><code class=language-language-javascript data-lang=language-javascript>var modalController = $controller(controller, inputs);
var modalElementTemplate = angular.element(template);
var linkFn = $compile(modalElementTemplate);
var modalElement = linkFn(modalScope);
</code></pre><p>Four innocuous lines that are actually quite complex.</p><ol><li>First, we create an instance of the controller with name <code>controller</code>. Regardless of what AngularJS injects, we provide <code>inputs</code> to be injected as well.</li><li>Now we turn our raw template html into an AngularJS DOM element. AngularJS always works with jQuery or jQuery Lite elements, the <code>angular.element</code> function takes raw HTML and turns it into a DOM element we can work with.</li><li>Now we <code>$compile</code> the element. This step goes over the DOM and expands all directives. We're turning raw DOM elements into elements that are expanded into directives, but we haven't yet linked this set of elements into a scope. This is the first step of the compile/link process.</li><li>Finally, we can link the element. The <code>$compile</code> function returns a link function which we call with a scope to link the DOM elements (fully expanded) to the specified scope.</li></ol><p>This is very similar to AngularJS actually handles directives itself - creating a scope, loading a template, turning it into an element, compiling it and linking it.</p><p>Why are compile and link separate steps? Think of it like this, the work that is done in compile is actually identical for each instance of a directive (or modal in our case). It's not related to an <em>instance</em> of a directive or modal, it's just expanding the elements and directives. So this work can be done once only, saving a lot of time - then we just call link to create an <em>instance</em> of our element, bound to a specific scope. So link logic is always per instance (you have a scope, you can <code>$watch</code> and so on) whereas compile logic is per <em>type</em> of directive.</p><p>Based on this, we could in fact cache the results of the compile function on a per-template basis, as they can be reused and linked to a scope as necessary. However this is an optimisation that is currently left out.</p><p>Now we can add the fully built element to the DOM and build our return object.</p><pre><code class=language-language-javascript data-lang=language-javascript>body.append(modalElement);

var modal = {
  controller: modalController,
  scope: modalScope,
  element: modalElement,
  close: closeDeferred.promise
};
</code></pre><p>We return the four things the caller might need - the controller, scope, element and close promise. When the close promise is resolved, we also want to clean up:</p><pre><code class=language-language-javascript data-lang=language-javascript>modal.close.then(function(result) {
  modalScope.$destroy();
  modalElement.remove();
});

deferred.resolve(modal);
</code></pre><p>So when <code>close</code> is resolved, whatever happens we'll destroy the scope and clean up the DOM. Now we can resolve our promise with the <code>modal</code> object we've built&mldr;</p><pre><code class=language-language-javascript data-lang=language-javascript>  .catch(function(error) {
  deferred.reject(error);
});
return deferred.promise;
</code></pre><p>&mldr;and we can pass errors that occured during <code>getTemplate</code> to the caller and finally return the promise we've built.</p><p>That's it! With this design we handle errors correctly, can pass data to and from the modal, clean up after ourselves and make sure that units of asynchronous work are handled with the standard pattern of promises.</p><h2 id=wrapping-up>Wrapping Up</h2><p>I hope you've found the service and some of the details of the code useful, as always comments are welcome, fork the code and have a play - let me know if you think of improvements or have questions,</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/tags/AngularJS/>AngularJS</a>,
<a href=/tags/CodeProject/>CodeProject</a>,
<a href=/tags/Javascript/>Javascript</a>,
<a href=/tags/Bootstrap/>Bootstrap</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=The%20Only%20AngularJS%20Modal%20Service%20You%27ll%20Ever%20Need&url=http%3a%2f%2fexample.org%2fthe-only-angularjs-modal-service-youll-ever-need%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><i class="fa fa-twitter"></i><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fexample.org%2fthe-only-angularjs-modal-service-youll-ever-need%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><i class="fa fa-facebook"></i><span class=hidden>Facebook</span></a></div></footer><div class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"dmwkerr"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=dwmkerr.com href=http://example.org/>dwmkerr.com</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2019 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=http://example.org/js/jquery-1.11.3.min.js></script><script src=http://example.org/js/jquery.fitvids.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=http://example.org/js/scripts.js></script></body></html>