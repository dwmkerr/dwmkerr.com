<!doctype html><html lang=en-uk prefix="og: http://ogp.me/ns#">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Modernising .NET projects for .NET Core and beyond!</title><meta property="og:title" content="Modernising .NET projects for .NET Core and beyond!">
<meta name=twitter:title content="Modernising .NET projects for .NET Core and beyond!">
<meta name=description content="In this article I'll describe how to modernise your .NET Framework projects for .NET Core, the .NET Standard and .NET 5, which is planned to be released this year.">
<meta property="og:description" content="In this article I'll describe how to modernise your .NET Framework projects for .NET Core, the .NET Standard and .NET 5, which is planned to be released this year.">
<meta name=twitter:description content="In this article I'll describe how to modernise your .NET Framework projects for .NET Core, the .NET Standard and .NET 5, which is planned to be released this year.">
<meta name=author content="Dave Kerr">
<meta property="og:site_name" content="dwmkerr.com">
<meta property="og:url" content="https://dwmkerr.com/modernising-dotnet-projects/">
<meta name=twitter:card content="summary">
<meta name=twitter:site content="@dwmkerr">
<meta name=twitter:creator content="@dwmkerr">
<meta property="og:type" content="article">
<meta name=generator content="Hugo 0.93.0">
<link rel=stylesheet href=https://dwmkerr.com/css/style.css>
<link rel=icon type=image/x-icon href=https://dwmkerr.com/images/favicon.ico>
</head><body>
<a href=#main class="skip-link p-screen-reader-text">Skip to content</a><svg xmlns="http://www.w3.org/2000/svg" style="display:none" aria-hidden="true"><symbol id="icon-500px" viewBox="0 0 16 16"><g><path d="M3.953 10.512a5.24 5.24.0 006.996 3.141c.625-.262 1.184-.641 1.666-1.122s.859-1.041 1.122-1.666c.272-.647.412-1.331.412-2.037s-.137-1.394-.412-2.037c-.262-.625-.641-1.184-1.122-1.666s-1.041-.859-1.666-1.122A5.226 5.226.0 008.912 3.59c-.716.0-1.431.144-2.066.413-.509.216-1.372.769-1.875 1.291l-.003.003V.984h7.241c.262-.003.262-.372.262-.491.0-.122.0-.487-.266-.491H4.377a.343.343.0 00-.344.341v6.066c0 .197.244.338.472.384.444.094.544-.047.653-.197l.016-.019c.166-.247.681-.766.688-.772a4.262 4.262.0 013.037-1.25c1.147.0 2.222.444 3.028 1.25a4.245 4.245.0 011.256 3.019 4.236 4.236.0 01-1.25 3.019 4.336 4.336.0 01-3.047 1.25 4.136 4.136.0 01-2.159-.597l.003-3.688c0-.491.213-1.028.572-1.431a2.09 2.09.0 011.588-.716c.594.0 1.15.225 1.566.634.409.406.637.95.637 1.528A2.179 2.179.0 018.887 11.02c-.238.0-.672-.106-.691-.109-.25-.075-.356.272-.391.387-.134.441.069.528.109.541.397.125.659.147 1.003.147a3.173 3.173.0 003.169-3.169c0-1.734-1.422-3.144-3.166-3.144-.856.0-1.659.328-2.263.919-.575.566-.903 1.319-.903 2.069v.019c-.003.094-.003 2.306-.006 3.031l-.003-.003c-.328-.363-.653-.919-.869-1.488-.084-.222-.275-.184-.534-.103-.125.034-.469.141-.391.394zm3.722-.865c0 .106.097.2.156.253l.019.019c.1.097.194.147.281.147a.181.181.0 00.131-.05c.044-.041.537-.544.588-.591l.553.55c.05.056.106.088.172.088.088.0.184-.053.284-.156.238-.244.119-.375.063-.438l-.559-.559.584-.588c.128-.137.016-.284-.097-.397-.162-.162-.322-.206-.422-.112l-.581.581-.588-.588a.16.16.0 00-.113-.047c-.078.0-.172.053-.275.156-.181.181-.219.306-.125.406l.588.584-.584.584c-.053.05-.078.103-.075.156zm1.278-7.931c-.938.0-1.938.191-2.669.506a.207.207.0 00-.134.181.753.753.0 00.069.337c.047.116.166.425.4.334a6.689 6.689.0 012.334-.444 6.35 6.35.0 012.469.497c.622.263 1.206.644 1.844 1.194a.22.22.0 00.147.059c.125.0.244-.122.347-.237.169-.191.287-.35.119-.509a6.858 6.858.0 00-2.1-1.356 7.326 7.326.0 00-2.825-.563zM14.006 13.3c-.113-.113-.209-.178-.294-.203s-.162-.006-.222.053l-.056.056a6.32 6.32.0 01-6.938 1.356 6.336 6.336.0 01-2.013-1.356 6.046 6.046.0 01-1.356-2.012c-.288-.713-.381-1.247-.413-1.422-.003-.016-.006-.028-.006-.037-.041-.206-.231-.222-.503-.178-.112.019-.459.072-.428.319v.006a7.261 7.261.0 002.04 3.994 7.266 7.266.0 0010.288.0l.059-.059c.069-.084.134-.225-.159-.516z"/></g></symbol><symbol id="icon-codepen" viewBox="0 0 16 16"><g><path d="M14.777 5.751l-7-4.667a.5.5.0 00-.555.0l-7 4.667a.501.501.0 00-.223.416v4.667c0 .167.084.323.223.416l7 4.667a.5.5.0 00.554.0l7-4.667a.501.501.0 00.223-.416V6.167a.501.501.0 00-.223-.416zM7.5 10.232 4.901 8.5 7.5 6.768 10.099 8.5 7.5 10.232zM8 5.899V2.434l5.599 3.732L11 7.898l-3-2zm-1 0-3 2-2.599-1.732L7 2.435V5.9zM3.099 8.5 1 9.899V7.101L3.099 8.5zM4 9.101l3 2v3.465l-5.599-3.732L4 9.102zm4 2 3-2 2.599 1.732L8 14.565V11.1zM11.901 8.5 14 7.101v2.798L11.901 8.5z"/></g></symbol><symbol id="icon-dribbble" viewBox="0 0 16 16"><g><path d="M8 16c-4.412.0-8-3.588-8-8s3.587-8 8-8c4.412.0 8 3.587 8 8s-3.588 8-8 8zm6.747-6.906c-.234-.075-2.116-.634-4.256-.291a29.7 29.7.0 011.328 4.872 6.845 6.845.0 002.928-4.581zM10.669 14.3c-.103-.6-.497-2.688-1.456-5.181-.016.006-.031.009-.044.016-3.856 1.344-5.241 4.016-5.362 4.266a6.807 6.807.0 006.863.9zm-7.747-1.722c.156-.266 2.031-3.369 5.553-4.509a7.04 7.04.0 01.269-.081 24.04 24.04.0 00-.553-1.159c-3.409 1.022-6.722.978-7.022.975-.003.069-.003.138-.003.209.0 1.753.666 3.356 1.756 4.566zM1.313 6.609c.306.003 3.122.016 6.319-.831A43.092 43.092.0 005.098 1.825 6.854 6.854.0 001.314 6.609zM6.4 1.366a36.612 36.612.0 012.55 4c2.431-.909 3.459-2.294 3.581-2.469A6.799 6.799.0 006.4 1.366zm6.891 2.325c-.144.194-1.291 1.663-3.816 2.694.159.325.313.656.453.991.05.119.1.234.147.353 2.275-.284 4.534.172 4.759.219A6.816 6.816.0 0013.29 3.692z"/></g></symbol><symbol id="icon-facebook" viewBox="0 0 16 16"><g><path d="M9.5 3H12V0H9.5C7.57.0 6 1.57 6 3.5V5H4v3h2v8h3V8h2.5l.5-3H9V3.5c0-.271.229-.5.5-.5z"/></g></symbol><symbol id="icon-feed" viewBox="0 0 16 16"><g><path d="M2.13 11.733c-1.175.0-2.13.958-2.13 2.126.0 1.174.955 2.122 2.13 2.122a2.126 2.126.0 002.133-2.122A2.133 2.133.0 002.13 11.733zM.002 5.436v3.067c1.997.0 3.874.781 5.288 2.196a7.45 7.45.0 012.192 5.302h3.08c0-5.825-4.739-10.564-10.56-10.564zM.006.0v3.068C7.128 3.068 12.924 8.87 12.924 16H16C16 7.18 8.824.0.006.0z"/></g></symbol><symbol id="icon-flickr" viewBox="0 0 16 16"><g><path d="M0 8.5a3.5 3.5.0 117 0 3.5 3.5.0 01-7 0zm9 0a3.5 3.5.0 117 0 3.5 3.5.0 01-7 0z"/></g></symbol><symbol id="icon-github" viewBox="0 0 16 16"><g><path d="M8 .198A8 8 0 005.471 15.789c.4.074.547-.174.547-.385.0-.191-.008-.821-.011-1.489-2.226.484-2.695-.944-2.695-.944-.364-.925-.888-1.171-.888-1.171-.726-.497.055-.486.055-.486.803.056 1.226.824 1.226.824.714 1.223 1.872.869 2.328.665.072-.517.279-.87.508-1.07-1.777-.202-3.645-.888-3.645-3.954.0-.873.313-1.587.824-2.147-.083-.202-.357-1.015.077-2.117.0.0.672-.215 2.201.82A7.672 7.672.0 018 4.066c.68.003 1.365.092 2.004.269 1.527-1.035 2.198-.82 2.198-.82.435 1.102.162 1.916.079 2.117.513.56.823 1.274.823 2.147.0 3.073-1.872 3.749-3.653 3.947.287.248.543.735.543 1.481.0 1.07-.009 1.932-.009 2.195.0.213.144.462.55.384A8 8 0 008.001.196z"/></g></symbol><symbol id="icon-gitlab" viewBox="0 0 28 28"><g><path d="M1.625 11.031 14 26.89.437 17.046a1.092 1.092.0 01-.391-1.203l1.578-4.813zm7.219.0h10.313L14.001 26.89zM5.75 1.469l3.094 9.562H1.625l3.094-9.562a.548.548.0 011.031.0zm20.625 9.562 1.578 4.813a1.09 1.09.0 01-.391 1.203l-13.563 9.844 12.375-15.859zm0 0h-7.219l3.094-9.562a.548.548.0 011.031.0z"/></g></symbol><symbol id="icon-google-plus" viewBox="0 0 16 16"><g><path d="M5.091 7.147v1.747h2.888c-.116.75-.872 2.197-2.888 2.197-1.737.0-3.156-1.441-3.156-3.216s1.419-3.216 3.156-3.216c.991.0 1.65.422 2.028.784L8.5 4.112c-.888-.828-2.037-1.331-3.409-1.331C2.275 2.784.0 5.059.0 7.875s2.275 5.091 5.091 5.091c2.937.0 4.888-2.066 4.888-4.975.0-.334-.037-.591-.081-.844H5.092zM16 7h-1.5V5.5H13V7h-1.5v1.5H13V10h1.5V8.5H16z"/></g></symbol><symbol id="icon-instagram" viewBox="0 0 22 22"><g><path d="M15.445.0H6.554A6.559 6.559.0 000 6.554v8.891A6.559 6.559.0 006.554 22h8.891a6.56 6.56.0 006.554-6.555V6.554A6.557 6.557.0 0015.445.0zm4.342 15.445a4.343 4.343.0 01-4.342 4.342H6.554a4.341 4.341.0 01-4.341-4.342V6.554a4.34 4.34.0 014.341-4.341h8.891a4.342 4.342.0 014.341 4.341l.001 8.891z"/><path d="M11 5.312A5.693 5.693.0 005.312 11 5.694 5.694.0 0011 16.688 5.694 5.694.0 0016.688 11 5.693 5.693.0 0011 5.312zm0 9.163a3.475 3.475.0 11-.001-6.95 3.475 3.475.0 01.001 6.95zm5.7-10.484a1.363 1.363.0 11-1.364 1.364c0-.752.51-1.364 1.364-1.364z"/></g></symbol><symbol id="icon-linkedin" viewBox="0 0 16 16"><g><path d="M6 6h2.767v1.418h.04C9.192 6.727 10.134 6 11.539 6 14.46 6 15 7.818 15 10.183V15h-2.885v-4.27c0-1.018-.021-2.329-1.5-2.329-1.502.0-1.732 1.109-1.732 2.255V15H6V6zM1 6h3v9H1V6zM4 3.5A1.5 1.5.0 11.999 3.499 1.5 1.5.0 014 3.5z"/></g></symbol><symbol id="icon-mail" viewBox="0 0 22 18"><g><path fill="#000" d="M0 17.225V.776h22v16.447H0v.002zm3.011-1.815h15.978l-5.111-5.115L11 13.179l-2.877-2.883-5.112 5.114zm-1.216-1.275 5.077-5.09L1.795 3.98v10.155zm13.332-5.09 5.079 5.09V3.979l-5.079 5.066zm-4.126 1.588 8.022-8.027-16.045-.001 8.023 8.028z"/></g></symbol><symbol id="icon-medium" viewBox="0 0 24 24"><g><path d="M22.085 4.733 24 2.901V2.5h-6.634l-4.728 11.768L7.259 2.5H.303v.401L2.54 5.594c.218.199.332.49.303.783V16.96c.069.381-.055.773-.323 1.05L0 21.064v.396h7.145v-.401l-2.52-3.049a1.244 1.244.0 01-.347-1.05V7.806l6.272 13.659h.729l5.393-13.659v10.881c0 .287.0.346-.188.534l-1.94 1.877v.402h9.412v-.401l-1.87-1.831a.556.556.0 01-.214-.534V5.267a.554.554.0 01.213-.534z"/></g></symbol><symbol id="icon-npm" viewBox="0 0 16 16"><g><path d="M0 0v16h16V0H0zm13 13h-2V5H8v8H3V3h10v10z"/></g></symbol><symbol id="icon-pinterest" viewBox="0 0 16 16"><g><path d="M8 1.069A6.93 6.93.0 005.475 14.453c-.059-.547-.116-1.391.025-1.988.125-.541.813-3.444.813-3.444s-.206-.416-.206-1.028c0-.963.559-1.684 1.253-1.684.591.0.878.444.878.975.0.594-.378 1.484-.575 2.306-.166.691.344 1.253 1.025 1.253 1.231.0 2.178-1.3 2.178-3.175.0-1.659-1.194-2.819-2.894-2.819-1.972.0-3.128 1.478-3.128 3.009.0.597.228 1.234.516 1.581.056.069.066.128.047.2a95.89 95.89.0 01-.194.787c-.031.128-.1.153-.231.094-.866-.403-1.406-1.669-1.406-2.684.0-2.188 1.587-4.194 4.578-4.194 2.403.0 4.272 1.712 4.272 4.003.0 2.388-1.506 4.313-3.597 4.313-.703.0-1.362-.366-1.588-.797.0.0-.347 1.322-.431 1.647-.156.603-.578 1.356-.862 1.816a6.93 6.93.0 008.984-6.622A6.931 6.931.0 008.001 1.068z"/></g></symbol><symbol id="icon-search" viewBox="0 0 16 16"><g><path d="M15.504 13.616l-3.79-3.223c-.392-.353-.811-.514-1.149-.499a6 6 0 10-.672.672c-.016.338.146.757.499 1.149l3.223 3.79c.552.613 1.453.665 2.003.115s.498-1.452-.115-2.003zM6 10a4 4 0 110-8 4 4 0 010 8z"/></g></symbol><symbol id="icon-strava" viewBox="0 0 24 24"><g><path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599 2.836 5.598h4.172L10.463.0l-7 13.828h4.169"/></g></symbol><symbol id="icon-tumblr" viewBox="0 0 16 16"><g><path d="M9.001 7v3.659c0 .928-.012 1.463.086 1.727.098.262.342.534.609.691.354.212.758.318 1.214.318.81.0 1.289-.107 2.09-.633v2.405a9.089 9.089.0 01-1.833.639A7.93 7.93.0 019.369 16a4.9 4.9.0 01-1.725-.276 4.195 4.195.0 01-1.438-.79c-.398-.343-.672-.706-.826-1.091s-.23-.944-.23-1.676V6.556H3.003V4.29c.628-.204 1.331-.497 1.778-.877a4.386 4.386.0 001.08-1.374C6.133 1.505 6.32.825 6.422.0h2.579v4H13v3H9.001z"/></g></symbol><symbol id="icon-twitter" viewBox="0 0 16 16"><g><path d="M16 3.538a6.461 6.461.0 01-1.884.516 3.301 3.301.0 001.444-1.816 6.607 6.607.0 01-2.084.797 3.28 3.28.0 00-2.397-1.034A3.28 3.28.0 007.882 6.029 9.321 9.321.0 011.116 2.598a3.284 3.284.0 001.015 4.381A3.301 3.301.0 01.643 6.57v.041A3.283 3.283.0 003.277 9.83a3.291 3.291.0 01-1.485.057 3.293 3.293.0 003.066 2.281 6.586 6.586.0 01-4.862 1.359 9.286 9.286.0 005.034 1.475c6.037.0 9.341-5.003 9.341-9.341.0-.144-.003-.284-.009-.425a6.59 6.59.0 001.637-1.697z"/></g></symbol><symbol id="icon-vimeo" viewBox="0 0 16 16"><g><path d="M15.994 4.281c-.072 1.556-1.159 3.691-3.263 6.397-2.175 2.825-4.016 4.241-5.522 4.241-.931.0-1.722-.859-2.366-2.581-.431-1.578-.859-3.156-1.291-4.734-.478-1.722-.991-2.581-1.541-2.581-.119.0-.538.253-1.256.753l-.753-.969c.791-.694 1.569-1.388 2.334-2.081 1.053-.909 1.844-1.387 2.372-1.438 1.244-.119 2.013.731 2.3 2.553.309 1.966.525 3.188.647 3.666.359 1.631.753 2.447 1.184 2.447.334.0.838-.528 1.509-1.588.669-1.056 1.028-1.862 1.078-2.416.097-.912-.262-1.372-1.078-1.372a2.98 2.98.0 00-1.184.263c.787-2.575 2.287-3.825 4.506-3.753 1.641.044 2.416 1.109 2.322 3.194z"/></g></symbol><symbol id="icon-wordpress" viewBox="0 0 16 16"><g><path d="M2 8c0 2.313 1.38 4.312 3.382 5.259L2.52 5.622A5.693 5.693.0 002 8zm10.05-.295c0-.722-.266-1.222-.495-1.612-.304-.482-.589-.889-.589-1.371.0-.537.418-1.037 1.008-1.037.027.0.052.003.078.005A6.064 6.064.0 008 2.156 6.036 6.036.0 002.987 4.79c.141.004.274.007.386.007.627.0 1.599-.074 1.599-.074.323-.018.361.444.038.482.0.0-.325.037-.687.055l2.185 6.33 1.313-3.835-.935-2.495a12.304 12.304.0 01-.629-.055c-.323-.019-.285-.5.038-.482.0.0.991.074 1.58.074.627.0 1.599-.074 1.599-.074.323-.018.362.444.038.482.0.0-.326.037-.687.055l2.168 6.282.599-1.947c.259-.809.457-1.389.457-1.889zm-3.945.806-1.8 5.095a6.148 6.148.0 003.687-.093.52.52.0 01-.043-.081L8.105 8.511zm5.16-3.315c.026.186.04.386.04.601.0.593-.114 1.259-.456 2.093l-1.833 5.16c1.784-1.013 2.983-2.895 2.983-5.051a5.697 5.697.0 00-.735-2.803zM8 0a8 8 0 100 16A8 8 0 008 0zm0 15A7 7 0 118 1a7 7 0 010 14z"/></g></symbol><symbol id="icon-youtube" viewBox="0 0 16 16"><g><path d="M15.841 4.8s-.156-1.103-.637-1.587c-.609-.637-1.291-.641-1.603-.678-2.237-.163-5.597-.163-5.597-.163h-.006s-3.359.0-5.597.163c-.313.038-.994.041-1.603.678C.317 3.697.164 4.8.164 4.8S.005 6.094.005 7.391v1.213c0 1.294.159 2.591.159 2.591s.156 1.103.634 1.588c.609.637 1.409.616 1.766.684 1.281.122 5.441.159 5.441.159s3.363-.006 5.6-.166c.313-.037.994-.041 1.603-.678.481-.484.637-1.588.637-1.588s.159-1.294.159-2.591V7.39c-.003-1.294-.162-2.591-.162-2.591zm-9.494 5.275V5.578l4.322 2.256-4.322 2.241z"/></g></symbol></svg>
<header class=l-header>
<p class="c-title p-title"><a href=https://dwmkerr.com/ class=p-title__link>dwmkerr.com</a></p><p class=p-subtitle>
Articles on the craft of software development. No ads, no sponsored content.
</p></header><main id=main class=l-main>
<article class=p-article>
<header>
<h1>Modernising .NET projects for .NET Core and beyond!</h1><div>
<div class=c-meta>
Posted on
<time datetime=2020-07-01T00:00:00Z>
Jul 1, 2020
</time>
|
3617 words
|
~17 mins
</div></div><a href=https://dwmkerr.com/tags/.net class=c-tag>.NET</a>
<a href=https://dwmkerr.com/tags/c class=c-tag>C#</a>
<a href=https://dwmkerr.com/tags/devops class=c-tag>Devops</a>
<a href=https://dwmkerr.com/tags/codeproject class=c-tag>CodeProject</a>
</div></header><section id=js-article class=p-article__body>
<p>The world of .NET is going through a transformation. The .NET Framework is reaching end of life, <a href=https://docs.microsoft.com/en-gb/dotnet/core/>.NET Core</a> is an increasingly feature rich and robust platform to develop solutions which target Linux, MacOS, embedded devices, containers and more. There&rsquo;s also the .NET Standard.</p><p>But what does this mean for .NET <em>Framework</em> projects? In this article I&rsquo;ll describe how to modernise your .NET Framework projects for .NET Core, the .NET Standard and .NET 5, which is planned to be released this year. I&rsquo;ll also explain the high level differences between the platforms and what the consequences of upgrading are for consumers, developers and maintainers.</p><ul>
<li><a href=#the-net-framework-net-core-and-the-future>The .NET Framework, .NET Core and the Future</a></li><li><a href=#the-challenge-modernisation-and-compatibility>The Challenge: Modernisation and Compatibility</a></li><li><a href=#the-modernisation-process---introducing-our-two-villains>The Modernisation Process - Introducing our two Villains</a>
<ul>
<li><a href=#step-1---understand-the-domain>Step 1 - Understand the Domain</a></li><li><a href=#step-2---understand-the-goal---multi-platform-builds>Step 2 - Understand the Goal - Multi-Platform Builds</a></li><li><a href=#step-3---migrate-projects-leaf-wise>Step 3 - Migrate Projects &ldquo;Leaf-wise&rdquo;</a></li><li><a href=#step-4---refactor-rinse-repeat>Step 4 - Refactor, Rinse, Repeat</a></li><li><a href=#step-5---update-your-builds>Step 5 - Update Your Builds</a></li><li><a href=#step-6---simplify>Step 6 - Simplify!</a></li><li><a href=#step-7---test-test-test>Step 7 - Test, Test, Test</a></li><li><a href=#step-8---document-compatibility>Step 8 - Document Compatibility</a></li></ul></li><li><a href=#the-key-learnings>The Key Learnings</a></li></ul><h1 id=the-net-framework-net-core-and-the-future>The .NET Framework, .NET Core and the Future</h1><p>There&rsquo;s a lot which has been written on this topic, but it can still be a little overwhelming to understand just how all of these things fit together.</p><p>Here&rsquo;s a simple visual I&rsquo;ve created to try and put things into context:</p><p><img src=images/dotnet-timeline.png alt="Diagram: .NET Timeline"></p><p>I&rsquo;m only going to cover the bare essentials - but there are links to further reading on each topic if you want to go deeper. This article is mainly going to be focused on the practicality and consequence of migration and re-targeting.</p><p>First, the <strong>.NET Framework</strong>.</p><ul>
<li>The .NET Framework was created in 2002 as set of unified tools and standards to allow developers on the Microsoft Platform to more quickly build solutions, provide interoperability between languages and more. <a href=https://dotnet.microsoft.com/learn/dotnet/what-is-dotnet-framework>Read more about the .NET Framework</a>.</li><li>The .NET Framework rapidly gained popularity, partly due to the convenience of developing in C# rather than Basic or C/C++. C# provided a more developer friendly language than C or C++ for many use cases, and was heavily inspired by Java. <a href=https://docs.microsoft.com/en-us/dotnet/csharp/>Read more about C#</a>.</li><li>With the increase in popularity, the .NET Framework started to have more frequent releases and became a standard part of the Windows operating system, installed out of the box rather than on-demand if needed.</li><li>However - the .NET Framework only functioned on Microsoft Windows, which greatly limited its potential uses cases, even as more and more engineers used it for Web, Client Applications and mobile.</li></ul><p>Enter <strong>.NET Core</strong>.</p><ul>
<li>Microsoft signaled a <em>radical</em> switch in their strategy with the appointment of <a href=https://en.wikipedia.org/wiki/Satya_Nadella>Satya Nadella</a>, becoming increasingly focused on open source, and more importantly, deciding that the Microsoft development toolchain should not <em>force</em> users to use Windows as their execution environment</li><li>.NET Core was developed as a lightweight version of the .NET Framework, which could run on multiple platforms - including Linux and MacOS. <a href=https://docs.microsoft.com/en-gb/dotnet/core/>Read more about .NET Core</a>.</li><li>In a short period of time .NET Core became more and more feature rich, providing a lot of capabilities for web developers and front-end application developers.</li></ul><p>The challenges of <strong>divergence</strong> and the <strong>.NET Standard</strong>.</p><ul>
<li>As .NET Core became more feature rich, the API became closer to the .NET Framework - but they are still fundamentally different runtimes. A binary compiled for the .NET Core does not run on the .NET Framework and vice-versa.</li><li>To deal with this issue, Microsoft developed the <strong>.NET Standard</strong> - a specification of a set of APIs. If a runtime offered these APIs, then solutions built on <em>any runtime which meets the standard</em> could run on any compliant platform.</li></ul><p>What does this mean? Basically, the table below shows the consequences of this. If you build on .NET Core 2.0 (for example), you can also run on the .NET Framework 4.6.1. Mono 5.4, Unity 2018.1 and more, because all of these runtimes implement the <em>.NET Standard 2.0</em>.</p><p>Of course, some features are always going to be very platform specific, so the standard started out small but has grown over time.</p><p>Moving to <strong>convergence</strong> and <strong>.NET</strong>.</p><ul>
<li>Given that the later versions of the .NET Framework and .NET Core actually follow the same standard, the platforms are actually starting to become more and more similar.</li><li>They are becoming <em>so</em> similar that it no longer makes sense to maintain them separately. The next major version of <em>both</em> platforms is <strong>.NET 5</strong>. This is a new runtime which is the next version of .NET Core <em>and</em> the .NET Framework.</li></ul><p>This means that the .NET Framework and .NET Core are going to converge into a single platform, which will be wonderful for developers and simplify a complex landscape.</p><p>But what does this mean if you have .NET Framework projects? How do we modernise, and do we have to make trade-offs around compatibility?</p><h1 id=the-challenge-modernisation-and-compatibility>The Challenge: Modernisation and Compatibility</h1><p>I have a number of projects which target the .NET Framework. On <em>all</em> of these projects I have had multiple requests to migrate to the .NET Core, but I have had to hold off on this work until I could really understand in detail a few things:</p><ol>
<li>What would this mean for <em>consumers</em> of the libraries? Would they have to change the platform they use? Could this break things for them?</li><li>What would this mean for <em>developers</em> on the platform? Would they need to change their development environment? Would this cause problems?</li><li>What would this mean for <em>maintainers</em> of the libraries? Would this greatly increase build and deployment complexity?</li></ol><p>Finally I have found the time to be able to start to address these issues in detail - hopefully the learnings will be useful to anyone who is maintaining a .NET codebase and thinking about the future.</p><h1 id=the-modernisation-process---introducing-our-two-villains>The Modernisation Process - Introducing our two Villains</h1><p>There are two key projects I wanted to modernise. They are both reasonably well used, complex, and have some potentially serious complexities for multi-platform builds.</p><p><a href=https://github.com/dwmkerr/sharpgl><strong>SharpGL</strong></a> is a library that allows developers to use <a href=https://www.opengl.org/>OpenGL</a> in .NET applications. The big challenge? OpenGL is cross platform, but SharpGL <em>specifically</em> provides an interface to the <em>Windows</em> version of OpenGL. Can this possibly be made more future-proof? Could it ever target other platforms?</p><p><a href=https://github.com/dwmkerr/sharpshell><strong>SharpShell</strong></a> is a library that allows developers to build &lsquo;Shell Extensions&rsquo; for Windows. Shell extensions are customisations to the Windows user interface, so would not be portable across platforms, but I still want to ensure that the project is future proof.</p><p>What would be the experience with these two projects? I have other .NET projects, but they are far less popular and much more simple, my instinct is that if I can work through the process with <em>these</em> projects, the others should be more straightforward.</p><p>These are the steps I&rsquo;ve followed to modernise. I&rsquo;ll finish the article with a summary of the key learnings.</p><h2 id=step-1---understand-the-domain>Step 1 - Understand the Domain</h2><p>I cannot stress this enough. In all meaningful technology work, <em>understand the domain</em> you are dealing with. A quick Google on how to migrate, or following the formal migration guide was not enough for me. I knew I had to actually understand, at a reasonably detailed level, the differences in the runtime, the trade-offs, the process, the complexity.</p><p>This article is the result of that work - sometimes writing about a topic is the best way to force yourself to learn it.</p><p>Making changes rapidly and waiting to see what the consequences are can often work for small projects, internal tools and so on, but for a library which is relied upon by others is not good for the community. The last thing I wanted to do was make changes which had unintended consequences for users. So making sure that I learnt about this space, how things work under the hood, and what the expected changes in the future are was critical.</p><p>Hopefully for others the process of understanding the domain will be a little easier with this article to cover the high level topics. During my actual process of writing and migrating, I went a lot deeper than this article goes.</p><p>The key document to follow to actually <em>execute</em> the migration is the excellent official <a href=https://docs.microsoft.com/en-gb/dotnet/core/porting/>.NET Framework to .NET Core Porting Guide</a>.</p><h2 id=step-2---understand-the-goal---multi-platform-builds>Step 2 - Understand the Goal - Multi-Platform Builds</h2><p>Given the understanding of the domain, it made it much easier to understand what the required steps would be. Essentially, all that would be needed would be to target a version of the .NET Framework which adheres to a recent version of the .NET Standard. Once this was done, in theory the project could be built for the .NET Framework <em>and</em> for .NET Core, and also be ready for the upcoming .NET 5 release.</p><p>Multi-platform builds are supported in Visual Studio 2019. These builds allow us to have a single codebase, but build libraries for multiple platforms (i.e. the .NET Framework and .NET Core). The resulting binaries can be packed as a single package, and when consumers install the package, the appropriate library is installed.</p><p>This introduces the first of the significant consequences - modernising your project means you must migrate it to Visual Studio 2019.</p><p>In the past, this might have been more of an issue, licenses for Visual Studio were expensive, and many organisations were locked onto specific versions for compatibility issues (or because they were slow to upgrade). This seems to be the case less often nowadays, but is still an important consideration.</p><p>My projects were using Visual Studio 2017. This is how the project properties looked:</p><p><img src=./images/sharpgl-target-framework-2017.png alt="Screenshot: SharpGL Target Framework Properties for Visual Studio 2017"></p><p>Unsurprisingly the .NET Standard isn&rsquo;t mentioned. Time to upgrade to 2019. While I installed it I could reminisce about the excitement of buying Visual C++ .NET Learning Edition:</p><p><img src=./images/visual-cpp-dotnet-learning-edition.jpg alt="Photo: Visual C++ .NET 2003 Learning Edition"></p><p>And try and remember what is was like to be a 15 years old. I wonder if that box set is still kicking around somewhere, I want to see it again. So much has changed. But long install processes for Visual Studio haven&rsquo;t, at least they kept that:</p><p><img src=./images/install-visual-studio-2019.png alt="Screenshot: Visual Studio 2019 Installer"></p><p>When installing, remember to enable the .NET Core features.</p><h2 id=step-3---migrate-projects-leaf-wise>Step 3 - Migrate Projects &ldquo;Leaf-wise&rdquo;</h2><p>As per the <a href=https://docs.microsoft.com/en-gb/dotnet/core/porting/>Porting Guide</a>, we need to migrate each of the projects which make up the solution, starting with the &rsquo;leaves&rsquo; (projects which don&rsquo;t depend on other projects) and then moving up the tree to the &lsquo;root&rsquo; projects (projects which are depended on by others).</p><p>Visually, for a solution like SharpGL, that would mean the projects will need to be converted in the following order:</p><p><img src=./images/sharpgl-project-structure.png alt="Diagram: SharpGL Project Dependency Graph"></p><p>I was expecting each project to have quite different experiences:</p><ul>
<li><code>SharpGL.Serialization</code> is just a set of classes which load data from files. In theory, this library should become completely portable.</li><li><code>SharpGL.WPF</code> and <code>SharpGL.WinForms</code> are <em>specifically</em> for Windows front-end technologies. I expected these to be able to be ported, but don&rsquo;t expect them to work on other platforms (in the future there might be <code>SharpGL.OSx</code>, or <code>SharpGL.Gnome</code>, who knows)</li><li><code>SharpGL.SceneGraph</code> is a set of classes which represent 3D scenes - things like lights, cameras, materials and so on. I expect <em>some</em> of this to &lsquo;just work&rsquo;, but things like image loading to perhaps need some tweaking.</li><li><code>SharpGL</code> is just a wrapper around the Windows <code>opengl32.dll</code> library. I can&rsquo;t imagine this <em>working</em> anywhere but Windows, but how would the project structure porting go and would it build?</li></ul><p>The details on <em>how</em> to migrate a project are in the <a href=https://docs.microsoft.com/en-gb/dotnet/core/porting/>Porting Guide</a>, but the general approach will be:</p><ol>
<li>Attempt to convert to the latest project format with the <code>try-convert</code> tool</li><li>Re-target the project to the .NET Framework 4.7.2 (the first version which supports the .NET standard)</li><li>Repeat for projects which this project depends on, walking the tree of projects to the root</li><li>Run the Portability Analysis tool to see if there are APIs which are not available on certain platforms</li></ol><p>This is how you project might look after migration, having run the <code>try-convert</code>:</p><p><img src=./images/migrate-project.png alt="Screenshot: Ported Visual Studio Project"></p><p>Now we just need to edit the project files and change the line:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;TargetFramework&gt;</span>4.7.2<span style=color:#f92672>&lt;/TargetFramework&gt;</span>
</span></span></code></pre></div><p>To:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;TargetFrameworks&gt;</span>netcoreapp2.0;netcoreapp3.0;netcoreapp3.1;net40;net45;net472<span style=color:#f92672>&lt;/TargetFrameworks&gt;</span>
</span></span></code></pre></div><p>The targets you will choose will depend on the APIs you want to use. There is an Portability Analysis extension available which can build a portability report, here&rsquo;s what one looks like:</p><p><img src=./images/portability-report-summary.png alt="Screenshot: Portability Report Summary"></p><p>This will also show the <em>specific</em> APIs which are not compatible with specific targets:</p><p><img src=./images/portability-report.png alt="Screenshot: Portability Report Details"></p><p>Now it&rsquo;s time to move to the next step.</p><h2 id=step-4---refactor-rinse-repeat>Step 4 - Refactor, Rinse, Repeat</h2><p>This is the tricky part. You&rsquo;ll now need to work out whether you want to <em>remove</em> API calls which are not portable, try and use alternatives, or conditionally compile the code for different platforms.</p><p>If you are using non-portable APIs you may need to use conditional blocks to execute different code depending on the framework used. The <a href=https://docs.microsoft.com/en-us/dotnet/standard/frameworks#how-to-specify-target-frameworks>Target frameworks in SDK-style projects</a> guide shows how to do this.</p><p>You may also have to manually edit the project file to ensure that certain dependencies are <em>only</em> used for certain targets. You solution file and dependencies may end up looking something like this:</p><p><img src=./images/conditional-dependencies.png alt="Screenshot: Conditional Dependencies"></p><p>Once you have reloaded the project you&rsquo;ll see your dependencies can now be specified on a per-framework basis, and a build generates assemblies for each of the targets:</p><p><img src=./images/generated-assemblies.png alt="Screenshot: Generated Assemblies"></p><p>This process might be simple, or complex, depending on the nuances of your project. For me it was fairly iterative - starting by targeting only <code>net40</code> (the original target framework which I&rsquo;d used), then adding more and more targets.</p><p>Some targets will simply not be possible - for example .NET Core only supports WinForms and WPF from .NET Core 3.0 onwards; you won&rsquo;t be able to build a WinForms or WPF assembly which targets a lower version, the framework doesn&rsquo;t support it.</p><h2 id=step-5---update-your-builds>Step 5 - Update Your Builds</h2><p>At this stage, having fixed compatibility issues, you should have code which builds in Visual Studio.</p><p>Now I would recommend porting all of your build code to use the <code>dotnet</code> build system. This is going to maximise the portability and future-proof your project, you&rsquo;ll be able to run the builds on multiple platforms and are using the preferred standard tool (<code>msbuild</code> will essentially become legacy).</p><p>The way I like to structure things personally is have a set of scripts which you can run to build, test and package the code locally. You can then call these scripts from you CI tool of choice to automate things, but still keep the logic in your own code, rather than hidden away in a build system.</p><p>For example, in my SharpGL project I have the following scripts:</p><table>
<thead>
<tr>
<th>Script</th><th>Usage</th></tr></thead><tbody>
<tr>
<td><code>config.ps1</code></td><td>Ensure your machine can run builds by installing necessary components such as <code>nunit</code>. Should only need to be run once.</td></tr><tr>
<td><code>build.ps1</code></td><td>Build all solutions.</td></tr><tr>
<td><code>test.ps1</code></td><td>Run all tests, including those in samples.</td></tr><tr>
<td><code>coverage.ps1</code></td><td>Create a coverage report. Reports are written to <code>./artifacts/coverage</code></td></tr><tr>
<td><code>pack.ps1</code></td><td>Create all of the SharpGL NuGet packages, which are copied to <code>./artifacts/packages</code>.</td></tr></tbody></table><p>I updated my scripts to use the <code>dotnet</code> tool. For example, the &lsquo;build&rsquo; script looks something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps data-lang=ps><span style=display:flex><span><span style=color:#a6e22e>#</span> <span style=color:#a6e22e>Run</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>build,</span> <span style=color:#a6e22e>hiding</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>documentation</span> <span style=color:#a6e22e>warnings</span> <span style=color:#a6e22e>for</span> <span style=color:#a6e22e>pinvoke</span> <span style=color:#a6e22e>code.</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>$buildCommand</span> <span style=color:#a6e22e>=&#34;dotnet</span> <span style=color:#a6e22e>msbuild</span> <span style=color:#a6e22e>$PSScriptRoot\SharpGL.sln</span> <span style=color:#a6e22e>-noWarn:CS1591</span> <span style=color:#a6e22e>-noWarn:CS1573</span> <span style=color:#a6e22e>-t:Rebuild</span> <span style=color:#a6e22e>-p:Configuration=Release&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Write-Host</span> <span style=color:#a6e22e>&#34;Running:</span> <span style=color:#a6e22e>&#34;&#34;$buildCommand&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Invoke-Expression</span> <span style=color:#a6e22e>$buildCommand</span>
</span></span></code></pre></div><p>And the &lsquo;pack&rsquo; script looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps data-lang=ps><span style=display:flex><span><span style=color:#a6e22e>dotnet</span> <span style=color:#a6e22e>pack</span> <span style=color:#a6e22e>--no-restore</span> <span style=color:#a6e22e>--no-build</span> <span style=color:#a6e22e>&#34;$PSScriptRoot</span>/Core/SharpGL/SharpGL.csproj&#34; <span style=color:#a6e22e>-c:Release</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dotnet</span> <span style=color:#a6e22e>pack</span> <span style=color:#a6e22e>--no-restore</span> <span style=color:#a6e22e>--no-build</span> <span style=color:#a6e22e>&#34;$PSScriptRoot</span>/Core/SharpGL.SceneGraph/SharpGL.SceneGraph.csproj&#34; <span style=color:#a6e22e>-c:Release</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dotnet</span> <span style=color:#a6e22e>pack</span> <span style=color:#a6e22e>--no-restore</span> <span style=color:#a6e22e>--no-build</span> <span style=color:#a6e22e>&#34;$PSScriptRoot</span>/Core/SharpGL.Serialization/SharpGL.Serialization.csproj&#34; <span style=color:#a6e22e>-c:Release</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dotnet</span> <span style=color:#a6e22e>pack</span> <span style=color:#a6e22e>--no-restore</span> <span style=color:#a6e22e>--no-build</span> <span style=color:#a6e22e>&#34;$PSScriptRoot</span>/Core/SharpGL.WinForms/SharpGL.WinForms.csproj&#34; <span style=color:#a6e22e>-c:Release</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dotnet</span> <span style=color:#a6e22e>pack</span> <span style=color:#a6e22e>--no-restore</span> <span style=color:#a6e22e>--no-build</span> <span style=color:#a6e22e>&#34;$PSScriptRoot</span>/Core/SharpGL.WPF/SharpGL.WPF.csproj&#34; <span style=color:#a6e22e>-c:Release</span>
</span></span></code></pre></div><p>The actual scripts are a little more complex. But the key thing here is that I can run <em>any</em> part of the CI/CD process locally (to test, debug and so on) or on a CI/CD platform.</p><p>You will most likely have to <em>conditionally</em> reference certain components. The dependency for <code>net40</code> might be different to that for <code>netcoreapp3.0</code>. You&rsquo;ll see that in many of my project files there is now code like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;ItemGroup&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Reference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Design&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net40&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Reference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Design&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net45&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Reference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Design&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net472&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Reference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Windows.Forms&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net40&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Reference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Windows.Forms&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net45&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Reference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Windows.Forms&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net472&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/ItemGroup&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;ItemGroup&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;Microsoft.CSharp&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;4.7.0&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;netcoreapp3.0&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;Microsoft.CSharp&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;4.7.0&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;netcoreapp3.1&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;Microsoft.CSharp&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;4.7.0&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net45&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;Microsoft.CSharp&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;4.7.0&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net472&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Data.DataSetExtensions&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;4.5.0&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;netcoreapp3.0&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Data.DataSetExtensions&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;4.5.0&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;netcoreapp3.1&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Data.DataSetExtensions&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;4.5.0&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net45&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageReference</span> <span style=color:#a6e22e>Include=</span><span style=color:#e6db74>&#34;System.Data.DataSetExtensions&#34;</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;4.5.0&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(TargetFramework)&#39; == &#39;net472&#39;&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/ItemGroup&gt;</span>
</span></span></code></pre></div><p>In my case quite a bit of trial and error was needed to find the appropriate references for each platform.</p><h2 id=step-6---simplify>Step 6 - Simplify!</h2><p>One benefit I have found during this process is that you can <em>simplify</em> your projects. You no longer need any kind of &lsquo;automated NuGet restore&rsquo; functionality. This means you can remove code like this from your project files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;Import</span> <span style=color:#a6e22e>Project=</span><span style=color:#e6db74>&#34;$(SolutionDir)\.nuget\NuGet.targets&#34;</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;Exists(&#39;$(SolutionDir)\.nuget\NuGet.targets&#39;)&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;Target</span> <span style=color:#a6e22e>Name=</span><span style=color:#e6db74>&#34;EnsureNuGetPackageBuildImports&#34;</span> <span style=color:#a6e22e>BeforeTargets=</span><span style=color:#e6db74>&#34;PrepareForBuild&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;PropertyGroup&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;ErrorText&gt;</span>This project references NuGet package(s) that are missing on this computer. Use NuGet Package Restore to download them.  For more information, see http://go.microsoft.com/fwlink/?LinkID=322105. The missing file is {0}.<span style=color:#f92672>&lt;/ErrorText&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/PropertyGroup&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;Error</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;!Exists(&#39;..\packages\NUnit.3.11.0\build\NUnit.props&#39;)&#34;</span> <span style=color:#a6e22e>Text=</span><span style=color:#e6db74>&#34;$([System.String]::Format(&#39;$(ErrorText)&#39;, &#39;..\packages\NUnit.3.11.0\build\NUnit.props&#39;))&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;Error</span> <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;!Exists(&#39;..\packages\NUnit3TestAdapter.3.10.0\build\net35\NUnit3TestAdapter.props&#39;)&#34;</span> <span style=color:#a6e22e>Text=</span><span style=color:#e6db74>&#34;$([System.String]::Format(&#39;$(ErrorText)&#39;, &#39;..\packages\NUnit3TestAdapter.3.10.0\build\net35\NUnit3TestAdapter.props&#39;))&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/Target&gt;</span>
</span></span></code></pre></div><p>You can also remove your <code>project.json</code> as all of the data is now in the <code>csproj</code> file.</p><p>Another nice update is that you no longer need to maintain an <code>AssemblyInfo.cs</code> file; you can keep all of your assembly metadata in the <code>csproj</code> file.</p><p>Finally, you can almost certainly remove any <code>nuspec</code> files - all NuGet packaging data can also be embedded in the <code>csproj</code> file. For example, here&rsquo;s what my SharpShell project metadata looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;Project</span> <span style=color:#a6e22e>Sdk=</span><span style=color:#e6db74>&#34;Microsoft.NET.Sdk.WindowsDesktop&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PropertyGroup&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;TargetFrameworks&gt;</span>netcoreapp2.0;netcoreapp3.0;netcoreapp3.1;net40;net45;net472<span style=color:#f92672>&lt;/TargetFrameworks&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;OutputType&gt;</span>Library<span style=color:#f92672>&lt;/OutputType&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- The following properies are used to manage how the project is packaged. --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageId&gt;</span>SharpShell<span style=color:#f92672>&lt;/PackageId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Copyright&gt;</span>Copyright (c) Dave Kerr 2020<span style=color:#f92672>&lt;/Copyright&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageProjectUrl&gt;</span>https://github.com/dwmkerr/sharpshell<span style=color:#f92672>&lt;/PackageProjectUrl&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;RepositoryUrl&gt;</span>https://github.com/dwmkerr/sharpshell<span style=color:#f92672>&lt;/RepositoryUrl&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Version&gt;</span>3.1.1.0<span style=color:#f92672>&lt;/Version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Authors&gt;</span>Dave Kerr<span style=color:#f92672>&lt;/Authors&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Company&gt;</span>Dave Kerr<span style=color:#f92672>&lt;/Company&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;PackageTags&gt;</span>Shell;SharpShell;COM;Context Menu;Icon Handler<span style=color:#f92672>&lt;/PackageTags&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Description&gt;</span>SharpShell is a framework that lets you build Windows Shell Extensions using .NET Core or the .NET Framework.<span style=color:#f92672>&lt;/Description&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/PropertyGroup&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- ...snip... --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/Project&gt;</span>
</span></span></code></pre></div><p>This helps to keep a lot of the project dependency and property data in one place and is probably more convenient for many users.</p><p>You can see the <a href=https://github.com/dwmkerr/sharpgl/pull/177>Pull Request</a> for SharpGL to see how the project files were updated in this case. You can also see the <a href=https://github.com/dwmkerr/sharpshell/pull/331>SharpShell Pull Request</a>. The SharpShell version is still work in progress at the time of writing.</p><h2 id=step-7---test-test-test>Step 7 - Test, Test, Test</h2><p>Now for the fun part. You are going to <em>really</em> have to test the new packages on each platform. Sadly, this kind of migration is not something which will have issues exposed via unit tests, you&rsquo;ll need to create test projects which import your packages, ideally for each platform, and make sure they work. There could be runtime errors, particularly if you have made mistakes with the references.</p><p>Many issues will be caught at compile time - some will not.</p><p>Here&rsquo;s a screenshot of me having fun trying out the .NET Framework 4 package for WinForms, and the .NET Core 3.1 package for WPF:</p><p><img src=./images/test-packages.png alt="Screenshot: Testing SharpGL"></p><p>How you test your packages will be very dependent on what you are building. If it is highly platform specific then you will likely have to do lots of testing. If it is fairly self-contained code then you might be able to get away with some basic smoke testing.</p><h2 id=step-8---document-compatibility>Step 8 - Document Compatibility</h2><p>If you are supporting multiple platforms and frameworks, it&rsquo;s going to be a lot of help to consumers of your code if you can be very clear about <em>what is supported</em>.</p><p>This may be more complex than you think. Your library may run fine as part of a .NET Core Console Application on Windows - but does it work on MacOS? What about Linux?</p><p>Here&rsquo;s a screenshot I would never have imagined when I started the SharpGL project - a terminal application running on MacOS which is using the <code>SharpGL.Serialization</code> library to load geometry from a file:</p><p><img src=./images/sharpgl-on-mac.png alt="Screenshot: Loading Geometry in SharpGL on MacOS"></p><p>Now of course for something like SharpGL to run on a Mac or Linux, a lot more work would be needed. SharpGL is at its core nothing more than a wrapper around <code>opengl32.dll</code> on Windows, on other platforms there are no DLLs, but OpenGL <em>is</em> still available. So support is possible, but not ready yet. So at this stage, docmenting what you know works <em>as well as what doesn&rsquo;t</em> will be really helpful.</p><p>You might also want to preserve your &lsquo;pre-migration&rsquo; code in a separate branch, in case you have users who for some reason have issues migrating and need to use an older version. For SharpGL, I updated the project page to indicate compatibility, what has been tested and so on:</p><p><img src=./images/readme-compatability.png alt="Screenshot: SharpGL README showing compatibility information"></p><h1 id=the-key-learnings>The Key Learnings</h1><p>Here are the key learnings which stood out for me as I worked on migration of these projects.</p><p><strong>Consumer Experience</strong></p><ul>
<li>If you are careful, you don&rsquo;t have to break anything for consumers - with multi-targeting you can <em>still</em> target older frameworks.</li><li>You can potentially greatly increase the compatibility of your projects by offering support for .NET Core.</li></ul><p><strong>Developer Experience</strong></p><ul>
<li>You need to upgrade to Visual Studio 2019&mldr;</li><li>&mldr;however, you can use Visual Studio for Mac or even the command-line to build across many platforms.</li></ul><p><strong>Maintainer Experience</strong></p><ul>
<li>You will have a much larger set of potential consumers, but you will likely find bugs which are framework or platform specific.</li><li>You will likely need to work on migrating your project files and use the latest <code>dotnet</code> tooling.</li><li>You should be careful to document known compatibility issues.</li></ul><p>All in all, the process was less painful than I expected. Now that this work is done I can focus on more exciting things, such as potentially getting projects like SharpGL working on Linux or MacOS, which is much more exciting.</p><p>As always, questions, comments, suggestions, rants, anything are welcome!</p><p>The pull request which migrates the SharpGL project and SharpShell projects are below:</p><ul>
<li><a href=https://github.com/dwmkerr/sharpgl/pull/177/>github.com/dwmkerr/sharpgl/pull/177/</a></li><li><a href=https://github.com/dwmkerr/sharpshell/pull/331>github.com/dwmkerr/sharpshell/pull/331</a></li></ul><hr>
<p><strong>Useful References</strong></p><ul>
<li><a href=https://docs.microsoft.com/en-gb/dotnet/core/>Microsoft Docs: .NET Core Documentation</a></li><li><a href=https://docs.microsoft.com/en-gb/dotnet/core/porting/>Microsoft Docs: Overview of porting from .NET Framework to .NET Core</a></li><li><a href=https://docs.microsoft.com/en-us/dotnet/standard/frameworks#how-to-specify-target-frameworks>Microsoft Docs: Target frameworks in SDK-style projects</a></li></ul></section><footer>
<div id=disqus_thread></div><script>var disqus_shortname="dwmkerr";(function(){var e=document,t=e.createElement("script");t.src="https://"+disqus_shortname+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><nav class="p-pagination c-pagination">
<div class=c-pagination__ctrl>
<div class=c-pagination__newer>
<a href=https://dwmkerr.com/unit-testing-the-windows-registry/>Newer</a>
</div><div class=c-pagination__older>
<a href=https://dwmkerr.com/tips-for-cka/>Older</a>
</div></div></nav><section class=p-related>
<h3>See Also</h3><div class=p-related__list>
<div class="swiper swiper-container">
<ul class=swiper-wrapper>
<li class="p-related__item swiper-slide">
<a href=/tips-for-cka/>
<span>Observations, tips and tricks for the CKA certification</span>
</a>
</li><li class="p-related__item swiper-slide">
<a href=/conventional-commits-and-semantic-versioning-for-java/>
<span>Supercharge your Java Projects with Conventional Commits, Semantic Versioning and Semantic Releases</span>
</a>
</li><li class="p-related__item swiper-slide">
<a href=/effective-shell-for-beginners/>
<span>Effective Shell for Beginners</span>
</a>
</li><li class="p-related__item swiper-slide">
<a href=/effective-shell-7-shell-commands/>
<span>Effective Shell Part 7: The Subtleties of Shell Commands</span>
</a>
</li><li class="p-related__item swiper-slide">
<a href=/effective-shell-6-job-control/>
<span>Effective Shell Part 6: Everything You Don't Need To Know About Job Control</span>
</a>
</li><li class="p-related__item swiper-slide">
<a href=/effective-shell-part-5-understanding-the-shell/>
<span>Effective Shell Interlude: Understanding the Shell</span>
</a>
</li></ul></div><div class=related-prev></div><div class=related-next></div></div></section><aside class=p-author>
<div class="c-avatar p-author__avatar">
<img alt="Author Avatar" src=/images/avatar.jpeg>
</div><div class=p-author__body>
<p class="c-title p-author__name">Dave Kerr</p><p>Climber, Coder, Technology Consultant. Views expressed are my own.</p></div></aside></footer></article></main><nav class="l-nav p-menu">
<ul class=p-menu__lists>
<li class=p-menu__listitem>
<a href=/>Blog</a>
</li><li class=p-menu__listitem>
<a href=/page/speaking/>Speaking</a>
</li><li class=p-menu__listitem>
<a href=/page/about/>About</a>
</li></ul></nav><footer class=l-footer>
<ul class=c-links>
<li class=c-links__item>
<a href=https://twitter.com/dwmkerr target=_blank><svg viewBox="0 0 64 64" class="c-links__icon"><title>twitter</title><use xlink:href="#icon-twitter"/></svg>
</a>
</li><li class=c-links__item>
<a href=https://github.com/dwmkerr target=_blank><svg viewBox="0 0 64 64" class="c-links__icon"><title>github</title><use xlink:href="#icon-github"/></svg>
</a>
</li><li class=c-links__item>
<a href=https://www.npmjs.com/dwmkerr target=_blank><svg viewBox="0 0 64 64" class="c-links__icon"><title>npm</title><use xlink:href="#icon-npm"/></svg>
</a>
</li><li class=c-links__item>
<a href=https://linkedin.com/in/dwmkerr target=_blank><svg viewBox="0 0 64 64" class="c-links__icon"><title>linkedin</title><use xlink:href="#icon-linkedin"/></svg>
</a>
</li></ul><p class=p-copyright>
Copright &copy; Dave Kerr
</p></footer><script type=text/javascript src=https://dwmkerr.com/js/bundle.js defer></script>
</body></html>