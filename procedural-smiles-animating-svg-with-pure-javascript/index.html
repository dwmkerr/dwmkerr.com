<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Procedural Smiles - Animating SVG with pure JavaScript &#183; Dave Kerr</title><meta name=description content="I recently needed to be able to generate a simple face image, with the face being able to scale from happy to sad.
(Why I needed to do this is a long story!)
This gave me the opportunity to have a play with SVG, which is something I've not done in a while and always wished I could spend more time with. You can see the result below, move the slider to see the smile animate:"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.61.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Procedural Smiles - Animating SVG with pure JavaScript"><meta property="og:description" content="I recently needed to be able to generate a simple face image, with the face being able to scale from happy to sad.
(Why I needed to do this is a long story!)
This gave me the opportunity to have a play with SVG, which is something I've not done in a while and always wished I could spend more time with. You can see the result below, move the slider to see the smile animate:"><meta property="og:type" content="article"><meta property="og:url" content="https://dwmkerr.github.io/dwmkerr.com/procedural-smiles-animating-svg-with-pure-javascript/"><link rel=stylesheet href=https://dwmkerr.github.io/dwmkerr.com/dist/styles.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-41728580-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=dwmkerr.com href=https://dwmkerr.github.io/dwmkerr.com/>dwmkerr.com</a></h1><a class=button-square href=https://dwmkerr.github.io/dwmkerr.com/index.xml><i class="fa fa-rss"></i></a><a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/dwmkerr rel=me><i class="fa fa-twitter"></i></a><a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/dwmkerr rel=me><i class="fa fa-github-alt"></i></a><a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href=https://stackoverflow.com/users/1189164/dave-kerr rel=me><i class="fa fa-stack-overflow"></i></a><a class="button-square button-social hint--top" data-hint=LinkedIn title=LinkedIn href=https://www.linkedin.com/in/dwmkerr/ rel=me><i class="fa fa-linkedin"></i></a></div><ul class=site-nav><li class=site-nav-item><a title=Blog href=/dwmkerr.com/>Blog</a></li><li class=site-nav-item><a title=Speaking href=/dwmkerr.com/page/speaking/>Speaking</a></li><li class=site-nav-item><a title=About href=/dwmkerr.com/page/about/>About</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Procedural Smiles - Animating SVG with pure JavaScript</h1><p class="post-date post-line"><span>Published <time datetime=2018-07-29 itemprop=datePublished>Sun, Jul 29, 2018</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/dwmkerr itemprop=url rel=author>Dave Kerr</a></span></span></p></header><div class="post-content clearfix" itemprop=articleBody><img class=post-featured-image src=/images/2018/07/smile-1.png><p>I recently needed to be able to generate a simple face image, with the face being able to scale from happy to sad.</p><p>(<em>Why</em> I needed to do this is a long story!)</p><p>This gave me the opportunity to have a play with SVG, which is something I've not done in a while and always wished I could spend more time with. You can see the result below, move the slider to see the smile animate:</p><p data-height=265 data-theme-id=0 data-slug-hash=ejejeX data-default-tab=result data-user=dwmkerr data-pen-title="SVG Smile" class=codepen>See the Pen <a href=https://codepen.io/dwmkerr/pen/ejejeX/>SVG Smile</a> by Dave Kerr (<a href=https://codepen.io/dwmkerr>@dwmkerr</a>) on <a href=https://codepen.io>CodePen</a>.</p><script async src=https://static.codepen.io/assets/embed/ei.js></script><p>Source: <a href=https://github.com/dwmkerr/svg-smile>github.com/dwmkerr/svg-smile/</a>
CodePen: <a href=https://codepen.io/dwmkerr/pen/ejejeX>codepen.io/dwmkerr/pen/ejejeX</a></p><h3 id=how-it-works---geometry>How it works - geometry</h3><p>This is quite a simple effect to achieve, the trick is just to work out how the geometry of the smile will work:</p><p><img src=images/points.jpg alt="Smile Geometry"></p><p>The black points are the start and end point of the smile, the red points are the control points for the <a href=%5E1>bezier curve</a>. This means that we can scale from a smile to a frown by just interpolating the position of the anchor and control points from the two extremes shown above.</p><p>The face itself (without styling) just looks like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>svg</span> <span style=color:#a6e22e>viewbox</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;0 0 120 120&#34;</span>&gt;
  &lt;<span style=color:#f92672>g</span> <span style=color:#a6e22e>transform</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;translate(60 60)&#39;</span>&gt;
    <span style=color:#75715e>&lt;!--</span><span style=color:#75715e> First the main circle for the face. </span><span style=color:#75715e>--&gt;</span>
    &lt;<span style=color:#f92672>circle</span>
      <span style=color:#a6e22e>cx</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;0&#34;</span>
      <span style=color:#a6e22e>cy</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;0&#34;</span>
      <span style=color:#a6e22e>r</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;50&#34;</span> /&gt;
    <span style=color:#75715e>&lt;!--</span><span style=color:#75715e> Then the left eye... </span><span style=color:#75715e>--&gt;</span>
    &lt;<span style=color:#f92672>circle</span>
      <span style=color:#a6e22e>cx</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-20&#34;</span>
      <span style=color:#a6e22e>cy</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-10&#34;</span>
      <span style=color:#a6e22e>r</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;5&#34;</span> /&gt;
    <span style=color:#75715e>&lt;!--</span><span style=color:#75715e> Then the right... </span><span style=color:#75715e>--&gt;</span>
    &lt;<span style=color:#f92672>circle</span>
      <span style=color:#a6e22e>cx</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;20&#34;</span>
      <span style=color:#a6e22e>cy</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-10&#34;</span>
      <span style=color:#a6e22e>r</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;5&#34;</span> /&gt;
    <span style=color:#75715e>&lt;!--</span><span style=color:#75715e> The smile bezier curve. </span><span style=color:#75715e>--&gt;</span>
    &lt;<span style=color:#f92672>g</span> <span style=color:#a6e22e>transform</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;translate(0, 25)&#34;</span>&gt;
      &lt;<span style=color:#f92672>path</span>
        <span style=color:#a6e22e>d</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;M-20,-10 C-20,10 20,10 20,-10&#34;</span> /&gt;
    &lt;/<span style=color:#f92672>g</span>&gt;
  &lt;/<span style=color:#f92672>g</span>&gt;
&lt;/<span style=color:#f92672>svg</span>&gt;
</code></pre></div><p>The trick here is really just to use whatever coordinate system works for you. I start by defining a viewbox that gives me some space, translate the origin and then put the main circle of the face slap bang in the middle at <code>(0, 0)</code>.</p><p>The code to interpolate the smile control points is easier again if we shift the origin of the smile as well. This technique works well for SVGs (or any computer graphics), manipulate and transform to get the coordinate system to work for you and make it easier to reason about what is going on.</p><h3 id=how-it-works---animation>How it works - animation</h3><p>I've not animated SVG before. When looking into doing this, the vast majority of tips, blogs, articles and so on were suggesting to use a libary (common suggestions were <a href=https://maxwellito.github.io/vivus/>vivus</a>, <a href=http://snapsvg.io/>snap.svg</a> and <a href=http://svgjs.com/>svg.js</a>).</p><p>I've got no doubt that when you know what you are doing with SVG, using a library is a huge accelerator and saves on boilerplate. But if you don't know what a library is doing, what it is wrapping, or the problems it is solving for you, you are likely missing out some fundamentals.</p><p>Using a library is great if you know <em>what the problem is you are solving</em>. But if you don't, you end up never really learning. I had no idea whether this would be challenging to do with the pure SVG APIs and definitely wanted to work by hand.</p><p>After some experimentation, I was able to write the markup which would move the smile to a frown:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>g</span> <span style=color:#a6e22e>transform</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;translate(0, 25)&#34;</span>&gt;
  &lt;<span style=color:#f92672>path</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;smilepath&#34;</span> <span style=color:#a6e22e>d</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;M-20,-10 C-20,10 20,10 20,-10&#34;</span>&gt;
    &lt;<span style=color:#f92672>animate</span>
      <span style=color:#a6e22e>attributeName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;d&#34;</span> <span style=color:#a6e22e>attributeType</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;XML&#34;</span>
      <span style=color:#a6e22e>to</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;M-20,10 C-20,-10 20,-10 20,10&#34;</span> <span style=color:#a6e22e>dur</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;3s&#34;</span>
      <span style=color:#a6e22e>repeatCount</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;indefinite&#34;</span>
      <span style=color:#a6e22e>fill</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;freeze&#34;</span>
    /&gt;
  &lt;/<span style=color:#f92672>path</span>&gt;
&lt;/<span style=color:#f92672>g</span>&gt;
</code></pre></div><p>The geometry we've already seen, all we've done here is swap the position of each anchor and its associated control point. The trick is just making sure that we get the attributes of the <code>animate</code> element right.</p><p>Once this is done, the final step is just to make it all programmatic. The code to generate the geometry of the path, based on a scale from 0 (sad) to 1 (happy) is online, but the interesting thing is how to run the animation:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// note that &#39;scale&#39; is 0-&gt;1 (sad-&gt;happy)
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>writeSmilePoints</span>(<span style=color:#a6e22e>smilePoints</span>(<span style=color:#a6e22e>scale</span>));
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>svg</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;svg&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>smilePath</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;smilepath&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>animate</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElementNS</span>(<span style=color:#a6e22e>svg</span>.<span style=color:#a6e22e>namespaceURI</span>, <span style=color:#e6db74>&#39;animate&#39;</span>);

<span style=color:#a6e22e>animate</span>.<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#39;attributeName&#39;</span>,<span style=color:#e6db74>&#39;d&#39;</span>);
<span style=color:#a6e22e>animate</span>.<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#39;attributeType&#39;</span>,<span style=color:#e6db74>&#39;XML&#39;</span>);
<span style=color:#a6e22e>animate</span>.<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#39;to&#39;</span>,<span style=color:#a6e22e>points</span>);
<span style=color:#a6e22e>animate</span>.<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#39;dur&#39;</span>,<span style=color:#e6db74>&#39;0.3s&#39;</span>);
<span style=color:#a6e22e>animate</span>.<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#39;repeatCount&#39;</span>,<span style=color:#e6db74>&#39;1&#39;</span>);
<span style=color:#a6e22e>animate</span>.<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#39;fill&#39;</span>,<span style=color:#e6db74>&#39;freeze&#39;</span>);
<span style=color:#a6e22e>smilePath</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>animate</span>);
<span style=color:#a6e22e>animate</span>.<span style=color:#a6e22e>beginElement</span>();
</code></pre></div><p>There's not much to it. The bulk of the code is just setting up the attributes for the <a href=https://developer.mozilla.org/en-US/docs/Web/SVG/Element/animate><code>animate</code></a> tag. Then we add it to the path as a child and call <a href=https://developer.mozilla.org/en-US/docs/Web/API/SVGAnimationElement><code>beginElement</code></a> to start the animation.</p><p>The face is coloured in a similar way. Interpolating between a happy Simpsons yellow and angry red in JavaScript, then setting an <code>animate</code> element to target the <code>fill</code> of the appropriate circle.</p><h3 id=wrapping-up>Wrapping Up</h3><p>Playing with graphics is fun! This is only the most basic scratching of the surface of what SVG can do. The JavaScript to animate is trivial (although I can appreciate that browser inconsistencies and so on mean a libary is probably useful at some point).</p><p>The code is available on GitHub at <a href=https://github.com/dwmkerr/svg-smile>github.com/dwmkerr/svg-smile</a> or on CodePen:</p><p data-height=265 data-theme-id=0 data-slug-hash=ejejeX data-default-tab=js,result data-user=dwmkerr data-pen-title="SVG Smile" class=codepen>See the Pen <a href=https://codepen.io/dwmkerr/pen/ejejeX/>SVG Smile</a> by Dave Kerr (<a href=https://codepen.io/dwmkerr>@dwmkerr</a>) on <a href=https://codepen.io>CodePen</a>.</p><script async src=https://static.codepen.io/assets/embed/ei.js></script></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/dwmkerr.com/tags/JavaScript/>JavaScript</a>,
<a href=/dwmkerr.com/tags/SVG/>SVG</a>,
<a href=/dwmkerr.com/tags/HTML/>HTML</a>,
<a href=/dwmkerr.com/tags/CSS/>CSS</a>,
<a href=/dwmkerr.com/tags/CodeProject/>CodeProject</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Procedural%20Smiles%20-%20Animating%20SVG%20with%20pure%20JavaScript&url=https%3a%2f%2fdwmkerr.github.io%2fdwmkerr.com%2fprocedural-smiles-animating-svg-with-pure-javascript%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><i class="fa fa-twitter"></i><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdwmkerr.github.io%2fdwmkerr.com%2fprocedural-smiles-animating-svg-with-pure-javascript%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><i class="fa fa-facebook"></i><span class=hidden>Facebook</span></a></div></footer><div class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"dmwkerr"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=dwmkerr.com href=https://dwmkerr.github.io/dwmkerr.com/>dwmkerr.com</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2019 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=https://dwmkerr.github.io/dwmkerr.com/js/jquery-1.11.3.min.js></script><script src=https://dwmkerr.github.io/dwmkerr.com/js/jquery.fitvids.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://dwmkerr.github.io/dwmkerr.com/js/scripts.js></script></body></html>