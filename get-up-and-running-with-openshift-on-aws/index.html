<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Get up and running with OpenShift on AWS &#183; Dave Kerr</title><meta name=description content="OpenShift is Red Hat's platform-as-a-service offering for hosting and scaling applications. It's built on top of Google's popular Kubernetes system.
Getting up and running with OpenShift Online is straightforward, as it is a cloud hosted solution. Setting up your own cluster is a little more complex, but in this article I'll show you how to make it fairly painless.
The repo for this project is at: github.com/dwmkerr/terraform-aws-openshift.
Creating the Infrastructure OpenShift has some fairly specific requirements about what hardware it runs on1."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.61.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Get up and running with OpenShift on AWS"><meta property="og:description" content="OpenShift is Red Hat's platform-as-a-service offering for hosting and scaling applications. It's built on top of Google's popular Kubernetes system.
Getting up and running with OpenShift Online is straightforward, as it is a cloud hosted solution. Setting up your own cluster is a little more complex, but in this article I'll show you how to make it fairly painless.
The repo for this project is at: github.com/dwmkerr/terraform-aws-openshift.
Creating the Infrastructure OpenShift has some fairly specific requirements about what hardware it runs on1."><meta property="og:type" content="article"><meta property="og:url" content="http://dwmkerr.com/get-up-and-running-with-openshift-on-aws/"><link rel=stylesheet href=http://dwmkerr.com/dist/styles.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-41728580-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=dwmkerr.com href=http://dwmkerr.com/>dwmkerr.com</a></h1><a class=button-square href=http://dwmkerr.com/index.xml><i class="fa fa-rss"></i></a><a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/dwmkerr rel=me><i class="fa fa-twitter"></i></a><a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/dwmkerr rel=me><i class="fa fa-github-alt"></i></a><a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href=https://stackoverflow.com/users/1189164/dave-kerr rel=me><i class="fa fa-stack-overflow"></i></a><a class="button-square button-social hint--top" data-hint=LinkedIn title=LinkedIn href=https://www.linkedin.com/in/dwmkerr/ rel=me><i class="fa fa-linkedin"></i></a></div><ul class=site-nav><li class=site-nav-item><a title=Blog href=/>Blog</a></li><li class=site-nav-item><a title=Speaking href=/page/speaking/>Speaking</a></li><li class=site-nav-item><a title=About href=/page/about/>About</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Get up and running with OpenShift on AWS</h1><p class="post-date post-line"><span>Published <time datetime=2017-02-02 itemprop=datePublished>Thu, Feb 2, 2017</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/dwmkerr itemprop=url rel=author>Dave Kerr</a></span></span></p></header><div class="post-content clearfix" itemprop=articleBody><img class=post-featured-image src=/images/2017/02/console2-1.png><p><a href=https://www.openshift.com/>OpenShift</a> is Red Hat's platform-as-a-service offering for hosting and scaling applications. It's built on top of Google's popular <a href=https://kubernetes.io/>Kubernetes</a> system.</p><p>Getting up and running with OpenShift Online is straightforward, as it is a cloud hosted solution. Setting up your own cluster is a little more complex, but in this article I'll show you how to make it fairly painless.</p><p><img src=images/welcome.png alt="OpenShift Login"></p><p>The repo for this project is at: <a href=https://github.com/dwmkerr/terraform-aws-openshift>github.com/dwmkerr/terraform-aws-openshift</a>.</p><h2 id=creating-the-infrastructure>Creating the Infrastructure</h2><p>OpenShift has some fairly specific requirements about what hardware it runs on<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. There's also DNS to set up, as well as internet access and so on.</p><p>All in all, for a bare-bones setup, you'll need something like this:</p><p><img src=images/network-diagram-2.png alt="Network Diagram"></p><p>Which is (deep breath):</p><ol><li>A network</li><li>A public subnet, with internet access via a gateway</li><li>A master host, which will run the OpenShift master</li><li>A pair of node hosts, which will run additional OpenShift nodes</li><li>A hosted zone, which allows us to configure DNS</li><li>A bastion, which allows us to SSH onto hosts, without directly exposing them</li><li>Some kind of basic log aggregation, which I'm using CloudWatch for</li></ol><p>This is not a production grade setup, which requires redundant masters and so on, but it provides the basics.</p><p>Rather than setting this infrastructure up by hand, this is all scripted with <a href=https://www.terraform.io/>Terraform</a>. To set up the infrastructure, clone the <a href=https://github.com/dwmkerr/terraform-aws-openshift>github.com/dwmkerr/terraform-aws-openshift</a> repo:</p><pre><code>$ git clone git@github.com:dwmkerr/terraform-aws-openshift
...
Resolving deltas: 100% (37/37), done.
</code></pre><p>Then use the terraform CLI<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> to create the infrastructure:</p><pre><code>$ cd terraform-aws-openshift/
$ terraform get &amp;&amp; terraform apply
</code></pre><p>You'll be asked for a region, to deploy the network into, here I'm using <code>us-west-1</code>:</p><p><img src=images/Screenshot-at-Feb-02-21-16-44.png alt="Enter Region"></p><p>After a few minutes the infrastructure will be set up:</p><p><img src=images/output.png alt="Terraform complete"></p><p>A quick glance at the AWS console shows the new hosts we've set up:</p><p><img src=images/aws.png alt="AWS Console"></p><p>The next step is to install OpenShift.</p><h2 id=installing-openshift>Installing OpenShift</h2><p>There are a few different ways to install OpenShift, but the one we'll use is called the &lsquo;advanced installation<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>'. This essentially involves:</p><ol><li>Creating an &lsquo;inventory&rsquo;, which specifies the hosts OpenShift will be installed on and the installation options</li><li>Downloading the advanced installation code</li><li>Running the advanced installation Ansible Playbook</li></ol><p>To create the inventory, we just run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sed <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>s/\${aws_instance.master.public_ip}/</span><span style=color:#66d9ef>$(</span>terraform output master-public_ip<span style=color:#66d9ef>)</span><span style=color:#e6db74>/</span><span style=color:#e6db74>&#34;</span> inventory.template.cfg &gt; inventory.cfg
</code></pre></div><p>This takes our &lsquo;inventory template<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>&rsquo; and populates it with the public IP of our master node, which is recorded in a Terraform output variable.</p><p>We can then copy the inventory to the bastion:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh-add ~/.ssh/id_rsa
scp ./inventory.cfg ec2-user@<span style=color:#66d9ef>$(</span>terraform output bastion-public_dns<span style=color:#66d9ef>)</span>:~
</code></pre></div><p>We can again use the Terraform output variables, this time to get the bastion IP. Finally, we pipe our install script to the bastion host:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cat install-from-bastion.sh | ssh -A ec2-user@<span style=color:#66d9ef>$(</span>terraform output bastion-public_dns<span style=color:#66d9ef>)</span>
</code></pre></div><p>There's a <a href=https://github.com/dwmkerr/terraform-aws-openshift/issues/1>bug</a> which means you might see <code>ansible-playbook: command not found</code>, if so, just run the script again. The install script clones the installation scripts and runs them, using the inventory we've provided:</p><p><img src=images/ansible.png alt="Ansible Output"></p><p>This'll probably take about 10 minutes to run. And that's it, OpenShift is installed:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>open <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>https://</span><span style=color:#66d9ef>$(</span>terraform output master-public_dns<span style=color:#66d9ef>)</span><span style=color:#e6db74>:8443</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><p>Hit &lsquo;advanced&rsquo; and continue, as we're using a self-signed certificate most browsers will complain:</p><p><img src=images/console1.png alt="Invalid Certificate"></p><p>Enter any username and password (the system is configured to allow anyone to access it by default) and you'll be presented with the OpenShift console:</p><p><img src=images/console2.png alt="OpenShift console"></p><p>As the setup requires three t2.large instances, which are not available on the free plan, you might want to clean up when you are done with:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>terraform destroy
</code></pre></div><h2 id=wrapping-up>Wrapping Up</h2><p>Hopefully you've found this useful, there are more details and references on the README of the github repo:</p><p><a href=https://github.com/dwmkerr/terraform-aws-openshift>https://github.com/dwmkerr/terraform-aws-openshift</a></p><p>Comments and feedback are always welcome!</p><hr><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>See <a href=https://docs.openshift.org/latest/install_config/install/prerequisites.html#system-requirements>https://docs.openshift.org/latest/install_config/install/prerequisites.html#system-requirements</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>Use &lsquo;brew install terraform&rsquo;, full instructions in the <a href=https://github.com/dwmkerr/terraform-aws-openshift>README.md</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>See <a href=https://docs.openshift.org/latest/install_config/install/advanced_install.html>https://docs.openshift.org/latest/install_config/install/advanced_install.html</a> <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>See <a href=https://github.com/dwmkerr/terraform-aws-openshift/blob/master/inventory.template.cfg>https://github.com/dwmkerr/terraform-aws-openshift/blob/master/inventory.template.cfg</a> <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/tags/CodeProject/>CodeProject</a>,
<a href=/tags/Terraform/>Terraform</a>,
<a href=/tags/Docker/>Docker</a>,
<a href=/tags/Microservices/>Microservices</a>,
<a href=/tags/AWS/>AWS</a>,
<a href=/tags/OpenShift/>OpenShift</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Get%20up%20and%20running%20with%20OpenShift%20on%20AWS&url=http%3a%2f%2fdwmkerr.com%2fget-up-and-running-with-openshift-on-aws%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><i class="fa fa-twitter"></i><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fdwmkerr.com%2fget-up-and-running-with-openshift-on-aws%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><i class="fa fa-facebook"></i><span class=hidden>Facebook</span></a></div></footer><div class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"dmwkerr"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=dwmkerr.com href=http://dwmkerr.com/>dwmkerr.com</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2019 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=http://dwmkerr.com/js/jquery-1.11.3.min.js></script><script src=http://dwmkerr.com/js/jquery.fitvids.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=http://dwmkerr.com/js/scripts.js></script></body></html>