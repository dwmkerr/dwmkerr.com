<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>A portable and magic-free way to open Pull Requests from the Command Line &#183; Dave Kerr</title><meta name=description content="This little bash snippet will let you open a GitHub or GitLab pull request from the command line on most Unix-like systems (OSX, Ubuntu, etc), without using any magic libraries, ZSH tricks or other dependencies.
Here's how it looks in action OSX:
And Ubuntu:
The script is available as the gpr.sh gist. You can also find it in my dotfiles, in the git.sh file.
The Script Here's the script in its entirety:"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.61.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="A portable and magic-free way to open Pull Requests from the Command Line"><meta property="og:description" content="This little bash snippet will let you open a GitHub or GitLab pull request from the command line on most Unix-like systems (OSX, Ubuntu, etc), without using any magic libraries, ZSH tricks or other dependencies.
Here's how it looks in action OSX:
And Ubuntu:
The script is available as the gpr.sh gist. You can also find it in my dotfiles, in the git.sh file.
The Script Here's the script in its entirety:"><meta property="og:type" content="article"><meta property="og:url" content="https://dwmkerr.github.io/dwmkerr.com/a-portable-and-magic-free-way-to-open-pull-requests-from-the-command-line/"><link rel=stylesheet href=https://dwmkerr.github.io/dwmkerr.com/dist/styles.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var dnt=(navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack);var doNotTrack=(dnt=="1"||dnt=="yes");if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-41728580-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=dwmkerr.com href=https://dwmkerr.github.io/dwmkerr.com/>dwmkerr.com</a></h1><a class=button-square href=https://dwmkerr.github.io/dwmkerr.com/index.xml><i class="fa fa-rss"></i></a><a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/dwmkerr rel=me><i class="fa fa-twitter"></i></a><a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/dwmkerr rel=me><i class="fa fa-github-alt"></i></a><a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href=https://stackoverflow.com/users/1189164/dave-kerr rel=me><i class="fa fa-stack-overflow"></i></a><a class="button-square button-social hint--top" data-hint=LinkedIn title=LinkedIn href=https://www.linkedin.com/in/dwmkerr/ rel=me><i class="fa fa-linkedin"></i></a></div><ul class=site-nav><li class=site-nav-item><a title=Blog href=/dwmkerr.com/>Blog</a></li><li class=site-nav-item><a title=Speaking href=/dwmkerr.com/page/speaking/>Speaking</a></li><li class=site-nav-item><a title=About href=/dwmkerr.com/page/about/>About</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">A portable and magic-free way to open Pull Requests from the Command Line</h1><p class="post-date post-line"><span>Published <time datetime=2018-10-10 itemprop=datePublished>Wed, Oct 10, 2018</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/dwmkerr itemprop=url rel=author>Dave Kerr</a></span></span></p></header><div class="post-content clearfix" itemprop=articleBody><img class=post-featured-image src=/images/2018/10/gpr-1.png><p>This little bash snippet will let you open a GitHub or GitLab pull request from the command line on most Unix-like systems (OSX, Ubuntu, etc), without using any magic libraries, ZSH tricks or other dependencies.</p><p><img src=images/gpr.png alt=gpr></p><p>Here's how it looks in action OSX:</p><p><img src=images/gpr.gif alt=gpr></p><p>And Ubuntu:</p><p><img src=images/gpr-ubuntu.gif alt=gpr-ubuntu></p><p>The script is available as the <a href=https://gist.github.com/dwmkerr/bae3fdca2d7208ec5d0008911d79b47d><code>gpr.sh</code></a> gist. You can also find it in my <a href=https://github.com/dwmkerr/dotfiles>dotfiles</a>, in the <a href=https://github.com/dwmkerr/dotfiles/blob/master/profile/git.sh>git.sh</a> file.</p><h2 id=the-script>The Script</h2><p>Here's the script in its entirety:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Colour constants for nicer output.</span>
GREEN<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;\033[0;32m&#39;</span>
RESET<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;\033[0m&#39;</span>

<span style=color:#75715e># Push the current branch to origin, set upstream, open the PR page if possible.</span>
gpr<span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#75715e># Get the current branch name, or use &#39;HEAD&#39; if we cannot get it.</span>
    branch<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>git symbolic-ref -q HEAD<span style=color:#66d9ef>)</span>
    branch<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>branch##refs/heads/<span style=color:#e6db74>}</span>
    branch<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>branch<span style=color:#66d9ef>:-</span>HEAD<span style=color:#e6db74>}</span>

    <span style=color:#75715e># Pushing take a little while, so let the user know we&#39;re working.</span>
    echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Opening pull request for </span><span style=color:#e6db74>${</span>GREEN<span style=color:#e6db74>}</span><span style=color:#e6db74>${</span>branch<span style=color:#e6db74>}</span><span style=color:#e6db74>${</span>RESET<span style=color:#e6db74>}</span><span style=color:#e6db74>...</span><span style=color:#e6db74>&#34;</span>

    <span style=color:#75715e># Push to origin, grabbing the output but then echoing it back.</span>
    push_output<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>git push origin -u <span style=color:#e6db74>${</span>branch<span style=color:#e6db74>}</span> 2&gt;&amp;1<span style=color:#e6db74>`</span>
    echo <span style=color:#e6db74>&#34;&#34;</span>
    echo <span style=color:#e6db74>${</span>push_output<span style=color:#e6db74>}</span>

    <span style=color:#75715e># If there&#39;s anything which starts with http, it&#39;s a good guess it&#39;ll be a</span>
    <span style=color:#75715e># link to GitHub/GitLab/Whatever. So open it.</span>
    link<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>${</span>push_output<span style=color:#e6db74>}</span> | grep -o <span style=color:#e6db74>&#39;http.*&#39;</span> | sed -e <span style=color:#e6db74>&#39;s/[[:space:]]*$//&#39;</span><span style=color:#66d9ef>)</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>${</span>link<span style=color:#e6db74>}</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
        echo <span style=color:#e6db74>&#34;&#34;</span>
        echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Opening: </span><span style=color:#e6db74>${</span>GREEN<span style=color:#e6db74>}</span><span style=color:#e6db74>${</span>link<span style=color:#e6db74>}</span><span style=color:#e6db74>${</span>RESET<span style=color:#e6db74>}</span><span style=color:#e6db74>...</span><span style=color:#e6db74>&#34;</span>
        python -mwebbrowser <span style=color:#e6db74>${</span>link<span style=color:#e6db74>}</span>
    <span style=color:#66d9ef>fi</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=how-it-works>How It Works</h2><p>Blow-by-blow, let's take a look.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># Colour constants for nicer output.</span>
GREEN<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;\033[0;32m&#39;</span>
RESET<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;\033[0m&#39;</span>
</code></pre></div><p>To make colouring console output easier, we create strings with the escape code required to set the &lsquo;green&rsquo; colour, and reset the text colour.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gpr<span style=color:#f92672>(</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#75715e># Get the current branch name, or use &#39;HEAD&#39; if we cannot get it.</span>
    branch<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>git symbolic-ref -q HEAD<span style=color:#66d9ef>)</span>
    branch<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>branch##refs/heads/<span style=color:#e6db74>}</span>
    branch<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>branch<span style=color:#66d9ef>:-</span>HEAD<span style=color:#e6db74>}</span>
</code></pre></div><p>Now we define the <code>gpr</code> (Git Pull Request) function. We'll need to push the current branch, so we need to get the current branch name. There's plenty of discussion on how this works on <a href=https://stackoverflow.com/questions/6245570/how-to-get-the-current-branch-name-in-git>Stack Overflow: How to get the current branch name in Git</a>. Essentially we just get the symbolic name for the head of our current branch, which will be something like this:</p><pre><code>refs/heads/my-new-branch
</code></pre><p>We then use <a href=https://www.tldp.org/LDP/abs/html/string-manipulation.html>Bash substring removal</a> to rip out the <code>ref/heads/</code> part. If we have no branch (for example, we are detached) we just use <code>HEAD</code> a the branch name.</p><p>Next we have this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>    <span style=color:#75715e># Pushing take a little while, so let the user know we&#39;re working.</span>
    echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Opening pull request for </span><span style=color:#e6db74>${</span>GREEN<span style=color:#e6db74>}</span><span style=color:#e6db74>${</span>branch<span style=color:#e6db74>}</span><span style=color:#e6db74>${</span>RESET<span style=color:#e6db74>}</span><span style=color:#e6db74>...</span><span style=color:#e6db74>&#34;</span>

    <span style=color:#75715e># Push to origin, grabbing the output but then echoing it back.</span>
    push_output<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>git push origin -u <span style=color:#e6db74>${</span>branch<span style=color:#e6db74>}</span> 2&gt;&amp;1<span style=color:#e6db74>`</span>
    echo <span style=color:#e6db74>&#34;&#34;</span>
    echo <span style=color:#e6db74>${</span>push_output<span style=color:#e6db74>}</span>
</code></pre></div><p>We've previously defined some strings which include the escape codes to colour terminal output. Now we just show the user the branch we're going to push, push it and then store all of the output in the <code>push_output</code> variable.</p><p>The <code>2>&1</code> idiom is a common one. This simply makes sure we put all <code>stderr</code> output (which is always file descriptor 2) into <code>stdout</code> (which is always file descriptor 1). This means whether the program writes output to <code>stdout</code> or <code>stderr</code>, we capture it. There's a nice write-up on this in the blog post &lsquo;<a href=https://www.brianstorti.com/understanding-shell-script-idiom-redirect/>Understanding Shell Script's idiom: 2>&1
</a>'.</p><p>The output from Git push will be dependent on the Git server being used. For GitHub it'll look like this:</p><pre><code>remote:
remote: Create a pull request for 'feat/doc-cleanup' on GitHub by visiting:
remote:      https://github.com/dwmkerr/dotfiles/pull/new/feat/doc-cleanup
remote:
To github.com:dwmkerr/dotfiles
 * [new branch]      feat/doc-cleanup -&gt; feat/doc-cleanup
Branch feat/doc-cleanup set up to track remote branch feat/doc-cleanup from origin.
</code></pre><p>Now all we want to do is see if there is any text which starts with <code>http</code> and if there is, then open it. Here's how we do that:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>    <span style=color:#75715e># If there&#39;s anything which starts with http, it&#39;s a good guess it&#39;ll be a</span>
    <span style=color:#75715e># link to GitHub/GitLab/Whatever. So open it.</span>
    link<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>${</span>push_output<span style=color:#e6db74>}</span> | grep -o <span style=color:#e6db74>&#39;http.*&#39;</span> | sed -e <span style=color:#e6db74>&#39;s/[[:space:]]*$//&#39;</span><span style=color:#66d9ef>)</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>${</span>link<span style=color:#e6db74>}</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
        echo <span style=color:#e6db74>&#34;&#34;</span>
        echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>Opening: </span><span style=color:#e6db74>${</span>GREEN<span style=color:#e6db74>}</span><span style=color:#e6db74>${</span>link<span style=color:#e6db74>}</span><span style=color:#e6db74>${</span>RESET<span style=color:#e6db74>}</span><span style=color:#e6db74>...</span><span style=color:#e6db74>&#34;</span>
        python -mwebbrowser <span style=color:#e6db74>${</span>link<span style=color:#e6db74>}</span>
    <span style=color:#66d9ef>fi</span>
</code></pre></div><p>This uses <code>grep</code> to rip out everything from <code>http</code> onwards, and the <code>sed</code> to remove any trailing whitespace. If we have found a link, we use <code>python</code> to open it (which is a fairly safe cross-platform solution).</p><p>That's it! When you have a branch ready which you want to push and create a pull request from, just run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gpr
</code></pre></div><p>And the branch will be pushed to <code>origin</code>, and if there is a Pull Request webpage, it'll be opened.</p><h2 id=prior-art>Prior Art</h2><p>My colleague Tobias recently shared a nice trick we worked out to open a GitLab merge request - which also now works for GitHub:</p><blockquote class=twitter-tweet data-lang=en><p lang=en dir=ltr>git push and directly open PR in Chrome - works for <a href="https://twitter.com/github?ref_src=twsrc%5Etfw">@github</a> & <a href="https://twitter.com/gitlab?ref_src=twsrc%5Etfw">@gitlab</a> ðŸš€<br><br>Here is how to set it up ðŸ‘‰ <a href=https://t.co/YfNTmdwTFt>https://t.co/YfNTmdwTFt</a> <a href="https://twitter.com/hashtag/github?src=hash&ref_src=twsrc%5Etfw">#github</a> <a href="https://twitter.com/hashtag/gitlab?src=hash&ref_src=twsrc%5Etfw">#gitlab</a> <a href=https://t.co/ISE9kVZmw1>pic.twitter.com/ISE9kVZmw1</a></p>&mdash; Tobias BÃ¼schel (@TobiasBueschel) <a href="https://twitter.com/TobiasBueschel/status/1042452158430502915?ref_src=twsrc%5Etfw">September 19, 2018</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>I wanted to be able to use the same trick in Ubuntu and other Linux distros, but realised it relied on <a href=https://github.com/robbyrussell/oh-my-zsh>oh-my-zsh</a> and assumed OSX with Chrome as the browser, so tweaked it to the above. Thanks Tobi!</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/dwmkerr.com/tags/Bash/>Bash</a>,
<a href=/dwmkerr.com/tags/Git/>Git</a>,
<a href=/dwmkerr.com/tags/Linux/>Linux</a>,
<a href=/dwmkerr.com/tags/CodeProject/>CodeProject</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=A%20portable%20and%20magic-free%20way%20to%20open%20Pull%20Requests%20from%20the%20Command%20Line&url=https%3a%2f%2fdwmkerr.github.io%2fdwmkerr.com%2fa-portable-and-magic-free-way-to-open-pull-requests-from-the-command-line%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><i class="fa fa-twitter"></i><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdwmkerr.github.io%2fdwmkerr.com%2fa-portable-and-magic-free-way-to-open-pull-requests-from-the-command-line%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><i class="fa fa-facebook"></i><span class=hidden>Facebook</span></a></div></footer><div class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"dmwkerr"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=dwmkerr.com href=https://dwmkerr.github.io/dwmkerr.com/>dwmkerr.com</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2019 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=https://dwmkerr.github.io/dwmkerr.com/js/jquery-1.11.3.min.js></script><script src=https://dwmkerr.github.io/dwmkerr.com/js/jquery.fitvids.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://dwmkerr.github.io/dwmkerr.com/js/scripts.js></script></body></html>